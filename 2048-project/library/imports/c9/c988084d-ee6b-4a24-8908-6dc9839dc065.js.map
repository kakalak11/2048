{"version":3,"sources":["../../../../assets/script/assets/script/gameBoard.js"],"names":["Emitter","require","cc","Class","extends","Component","properties","tilePrefab","Prefab","_tilesMatrix","_moving","_time","_check","_onKeyDown","event","keyCode","macro","KEY","right","d","node","emit","left","a","_moveLeft","down","s","_moveDown","up","w","_moveUp","space","log","every","element","index","array","undefined","number","getComponent","nextNumber","_moveRight","forEach","rowIndex","numbers","filter","active","zeros","concat","collumnIndex","runAction","sequence","moveTo","callFunc","i","shift","scheduleOnce","collumn","j","push","_combineRow","directionRight","reverse","skip","nextElement","elementScript","nextElementScript","copyTile","setNumber","scaleTo","action","moveBy","getPosition","v2","destroy","_combineCollumn","directionDown","_generateRandomValue","randomCollumn","Math","floor","random","randomRow","randomTile","scale","setPosition","_setupGrid","numberIndex","row","tile","instantiate","on","_onClick","name","Number","String","y","x","addChild","_addEvent","adjustRight","adjustDown","_checkWin","_checkLose","win","flat","script","onLoad","systemEvent","SystemEvent","EventType","KEY_DOWN","start","update","dt"],"mappings":"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","file":"gameBoard.js","sourceRoot":"../../../../assets/script","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/class.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/class.html\n// Learn Attribute:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] https://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\n\nconst Emitter = require('event');\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        tilePrefab: cc.Prefab,\n        _tilesMatrix: [],\n        _moving: null,\n        _time: 0.125,\n        _check: null,\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n\n    _onKeyDown: function (event) {\n        if (this._moving) return;\n        switch (event.keyCode) {\n            case cc.macro.KEY.right || cc.macro.KEY.d:\n                this._moving = true;\n                this.node.emit('right')\n                // this._moveRight();\n                break;\n            case cc.macro.KEY.left || cc.macro.KEY.a:\n                this._moving = true;\n                this._moveLeft();\n                break;\n            case cc.macro.KEY.down || cc.macro.KEY.s:\n                this._moving = true;\n                this._moveDown();\n                break;\n            case cc.macro.KEY.up || cc.macro.KEY.w:\n                this._moving = true;\n                this._moveUp();\n                break;\n            case cc.macro.KEY.space:\n                cc.log(this._tilesMatrix.every((element, index, array) => {\n                    if (element.every((element, index, array) => {\n                        if (array[index + 1] === undefined) return true;\n                        this.number = element.getComponent('tilesScript').number;\n                        this.nextNumber = array[index + 1].getComponent('tilesScript').number;\n                        if (this.number !== this.nextNumber) return true;\n                        return false;\n                    })) return true;\n                    return false;\n                }));\n                break;\n        }\n    },\n\n    _moveRight: function () {\n        this._tilesMatrix.forEach((element, rowIndex) => {\n            let numbers = element.filter(element => element.active);\n            let zeros = element.filter(element => !element.active);\n            element = zeros.concat(numbers);\n            element.forEach((element, collumnIndex) => element.runAction(cc.sequence(cc.moveTo(this._time, -157.5 + 105 * collumnIndex, 157.5 - 105 * rowIndex), cc.callFunc(() => {\n            }))));\n            cc.log()\n            for (let i = 0; i < 4; i++) {\n                this._tilesMatrix[rowIndex][i] = element.shift();\n            }\n        });\n        this.scheduleOnce(() => {\n            this.node.emit('combineRow', true);\n            this.node.emit('move');\n\n        }, this._time);\n\n    },\n\n    _moveLeft: function () {\n        this._tilesMatrix.forEach((element, rowIndex) => {\n            let numbers = element.filter(element => element.active);\n            let zeros = element.filter(element => !element.active);\n            element = numbers.concat(zeros);\n            element.forEach((element, collumnIndex) => element.runAction(cc.sequence(cc.moveTo(this._time, -157.5 + 105 * collumnIndex, 157.5 - 105 * rowIndex), cc.callFunc(() => {\n            }))));\n            for (let i = 0; i < 4; i++) {\n                this._tilesMatrix[rowIndex][i] = element.shift();\n            }\n        });\n        this.scheduleOnce(() => {\n            this.node.emit('combineRow', false);\n            this.node.emit('move');\n\n        }, this._time);\n    },\n\n    _moveDown: function () {\n        for (let i = 0; i < 4; i++) {\n            let collumn = [];\n            for (let j = 0; j < 4; j++) {\n                collumn.push(this._tilesMatrix[j][i]);\n            }\n            let numbers = collumn.filter(element => element.active);\n            let zeros = collumn.filter(element => !element.active);\n            collumn = zeros.concat(numbers);\n            for (let j = 0; j < 4; j++) {\n                this._tilesMatrix[j][i] = collumn.shift();\n            }\n        }\n        this._tilesMatrix.forEach((element, rowIndex) => element.forEach((element, collumnIndex) => {\n            element.runAction(cc.moveTo(this._time, -157.5 + 105 * collumnIndex, 157.5 - 105 * rowIndex));\n\n        }));\n        this.scheduleOnce(() => {\n            this.node.emit('combineCollumn', true);\n            this.node.emit('move');\n        }, this._time);\n    },\n\n    _moveUp: function () {\n        for (let i = 0; i < 4; i++) {\n            let collumn = [];\n            for (let j = 0; j < 4; j++) {\n                collumn.push(this._tilesMatrix[j][i]);\n            }\n            let numbers = collumn.filter(element => element.active);\n            let zeros = collumn.filter(element => !element.active);\n            collumn = numbers.concat(zeros);\n            for (let j = 0; j < 4; j++) {\n                this._tilesMatrix[j][i] = collumn.shift();\n            }\n        }\n        this._tilesMatrix.forEach((element, rowIndex) => element.forEach((element, collumnIndex) => {\n            element.runAction(cc.moveTo(this._time, -157.5 + 105 * collumnIndex, 157.5 - 105 * rowIndex));\n\n        }));\n        this.scheduleOnce(() => {\n            this.node.emit('combineCollumn', false);\n            this.node.emit('move');\n        }, this._time);\n    },\n\n    //  2  -  2  -  2  - 0  => move =>  0  -  2  -  2  -  2  => reverse =>  2  -  2  -  2  -  0  => combine =>  4  -  0  -  2  -  0  => reverse \n\n    _combineRow: function (directionRight) {\n        if (directionRight) {\n            this._tilesMatrix.forEach(element => {\n                element.reverse().forEach((element, index, array) => {\n                    if (this.skip) {\n                        this.skip = false;\n                        return;\n                    }\n                    this.nextElement = array[index + 1];\n                    this.elementScript = element.getComponent('tilesScript');\n                    if (this.nextElement === undefined) return;\n                    this.nextElementScript = this.nextElement.getComponent('tilesScript');\n                    if (this.elementScript.number === this.nextElementScript.number) {\n                        this.skip = true;\n                        let copyTile = this.nextElement;\n                        this.elementScript.setNumber(this.elementScript.number *= 2);\n                        element.runAction(cc.sequence(cc.scaleTo(0.125, 1.25), cc.scaleTo(0.125, 1)));\n                        this.nextElement.active = false;\n                        this.nextElementScript.setNumber(0);\n                        let action = cc.sequence(\n                            cc.moveBy(0.125, element.getPosition(cc.v2())),\n                            cc.callFunc(() => {\n                                copyTile.destroy();\n                            }),\n                        );\n                        copyTile.runAction(action);\n\n                    }\n                });\n                element.reverse();\n            });\n            this.node.emit('adjustRow', true);\n            return;\n        }\n\n        this._tilesMatrix.forEach(element => {\n            element.forEach((element, index, array) => {\n                if (this.skip) {\n                    this.skip = false;\n                    return;\n                }\n                this.nextElement = array[index + 1];\n                this.elementScript = element.getComponent('tilesScript');\n                if (this.nextElement === undefined) return;\n                this.nextElementScript = this.nextElement.getComponent('tilesScript');\n                if (this.elementScript.number === this.nextElementScript.number) {\n                    this.skip = true;\n                    let copyTile = this.nextElement;\n                    this.elementScript.setNumber(this.elementScript.number *= 2);\n                    element.runAction(cc.sequence(cc.scaleTo(0.125, 1.25), cc.scaleTo(0.125, 1)));\n                    this.nextElement.active = false;\n                    this.nextElementScript.setNumber(0);\n                    let action = cc.sequence(\n                        cc.moveBy(0.125, element.getPosition(cc.v2())),\n                        cc.callFunc(() => {\n                            copyTile.destroy();\n                        }),\n                    );\n                    copyTile.runAction(action);\n\n                }\n            });\n        });\n        this.node.emit('adjustRow', false);\n        return;\n    },\n\n    _combineCollumn: function (directionDown) {\n        if (directionDown) {\n            for (let i = 0; i < 4; i++) {\n                this.collumn = [];\n                for (let j = 0; j < 4; j++) {\n                    this.collumn.push(this._tilesMatrix[j][i]);\n                }\n                this.collumn.reverse().forEach((element, index, array) => {\n                    if (this.skip) {\n                        this.skip = false;\n                        return;\n                    }\n                    this.nextElement = array[index + 1];\n                    this.elementScript = element.getComponent('tilesScript');\n                    if (this.nextElement === undefined) return;\n                    this.nextElementScript = this.nextElement.getComponent('tilesScript');\n                    if (this.elementScript.number === this.nextElementScript.number) {\n                        this.skip = true;\n                        let copyTile = this.nextElement;\n                        // copyTile.setPosition(element.getPosition(cc.v2()));\n                        this.elementScript.setNumber(this.elementScript.number *= 2);\n                        element.runAction(cc.sequence(cc.scaleTo(0.125, 1.25), cc.scaleTo(0.125, 1)));\n                        this.nextElement.active = false;\n                        this.nextElementScript.setNumber(0);\n                        let action = cc.sequence(\n                            cc.moveTo(0.125, element.getPosition(cc.v2())),\n                            cc.callFunc(() => {\n                                copyTile.destroy();\n                            }),\n                        );\n                        copyTile.runAction(action);\n                    }\n                });\n                this.collumn.reverse();\n            }\n            this.node.emit('adjustCollumn', true);\n            return;\n        }\n\n\n\n        for (let i = 0; i < 4; i++) {\n            this.collumn = [];\n            for (let j = 0; j < 4; j++) {\n                this.collumn.push(this._tilesMatrix[j][i]);\n            }\n            this.collumn.forEach((element, index, array) => {\n                if (this.skip) {\n                    this.skip = false;\n                    return;\n                }\n                this.nextElement = array[index + 1];\n                this.elementScript = element.getComponent('tilesScript');\n                if (this.nextElement === undefined) return;\n                this.nextElementScript = this.nextElement.getComponent('tilesScript');\n                if (this.elementScript.number === this.nextElementScript.number) {\n                    this.skip = true;\n                    let copyTile = this.nextElement;\n                    // copyTile.setPosition(element.getPosition(cc.v2()));\n                    this.elementScript.setNumber(this.elementScript.number *= 2);\n                    element.runAction(cc.sequence(cc.scaleTo(0.125, 1.25), cc.scaleTo(0.125, 1)));\n                    this.nextElement.active = false;\n                    this.nextElementScript.setNumber(0);\n                    let action = cc.sequence(\n                        cc.moveTo(0.125, element.getPosition(cc.v2())),\n                        cc.callFunc(() => {\n                            copyTile.destroy();\n                        }),\n                    );\n                    copyTile.runAction(action);\n                }\n            });\n        }\n        this.node.emit('adjustCollumn', false);\n        return;\n    },\n\n    _generateRandomValue() {\n        if (!this._check) return;\n        do {\n            this.randomCollumn = Math.floor(Math.random() * 4);\n            this.randomRow = Math.floor(Math.random() * 4);\n            if (this._tilesMatrix.every(element => element.every(element => element.active))) {\n                this.node.emit('checkLose');\n                return;\n            }\n        } while (this._tilesMatrix[this.randomRow][this.randomCollumn].active);\n        this.randomTile = this._tilesMatrix[this.randomRow][this.randomCollumn];\n        this.number = this.randomTile.getComponent('tilesScript');\n        this.randomTile.active = true;\n        this.randomTile.scale = 0;\n        this.number.setNumber(Math.random() > 0.7 ? 4 : 2);\n        this.randomTile.setPosition(cc.v2(-157.5 + 105 * this.randomCollumn, 157.5 - 105 * this.randomRow));\n        this.randomTile.runAction(cc.sequence(cc.scaleTo(this._time, 1), cc.callFunc(() => this._check = false)));\n    },\n\n    _setupGrid() {\n        let numberIndex = 1;\n        this._tilesMatrix.push([], [], [], []);\n        for (let collumn = 0; collumn < 4; collumn++) {\n            for (let row = 0; row < 4; row++) {\n                this.tile = cc.instantiate(this.tilePrefab);\n                this.tile.active = false;\n                this.tile.on('mousedown', this._onClick, this.tile);\n                // tile.active ? tile.getComponent('tilesScript').setNumber(Math.random() > 0.5 ? 2 : 4) : tile.getComponent('tilesScript').setNumber(0);\n                this.tile.name = `tile ${numberIndex++}`;\n                this.tile.setPosition(cc.v2(-157.5 + 105 * row, 157.5 - 105 * collumn));\n                this.tile.on('position-changed', () => this._check = true, this);\n                this._tilesMatrix[Number(String((this.tile.getPosition().y - 157.5) * -1)[0])][Number(String(this.tile.getPosition().x + 157.5)[0])] = this.tile;\n                this.node.addChild(this.tile);\n            }\n        }\n        this._check = true;\n        // this._generateRandomValue();\n        // this._generateRandomValue();\n        for (let i = 0; i < 16; i++) this._generateRandomValue();\n        this._check = false;\n    },\n\n    _addEvent: function () {\n        this.node.on('move', this._generateRandomValue, this);\n        this.node.on('right', this._moveRight, this);\n        this.node.on('adjustRow', (adjustRight) => {\n            this._tilesMatrix.forEach((element, rowIndex) => {\n                let numbers = element.filter(element => element.active);\n                let zeros = element.filter(element => !element.active);\n                adjustRight ? element = zeros.concat(numbers) : element = numbers.concat(zeros);\n                element.forEach((element, collumnIndex) => element.runAction(cc.sequence(cc.moveTo(this._time, -157.5 + 105 * collumnIndex, 157.5 - 105 * rowIndex), cc.callFunc(() => {\n                    this._moving = false;\n                }))));\n                for (let i = 0; i < 4; i++) {\n                    this._tilesMatrix[rowIndex][i] = element.shift();\n                }\n            });\n            this.node.emit('checkWin');\n            // cc.log(this._tilesMatrix[0]);\n        }, this);\n        this.node.on('adjustCollumn', (adjustDown) => {\n            for (let i = 0; i < 4; i++) {\n                let collumn = [];\n                for (let j = 0; j < 4; j++) {\n                    collumn.push(this._tilesMatrix[j][i]);\n                }\n                let numbers = collumn.filter(element => element.active);\n                let zeros = collumn.filter(element => !element.active);\n                adjustDown ? collumn = zeros.concat(numbers) : collumn = numbers.concat(zeros);\n                for (let j = 0; j < 4; j++) {\n                    this._tilesMatrix[j][i] = collumn.shift();\n                }\n            }\n            this._tilesMatrix.forEach((element, rowIndex) => element.forEach((element, collumnIndex) => {\n                element.runAction(cc.moveTo(this._time, -157.5 + 105 * collumnIndex, 157.5 - 105 * rowIndex));\n                this._moving = false;\n            }));\n            this.node.emit('checkWin');\n        });\n        this.node.on('combineRow', this._combineRow, this);\n        this.node.on('combineCollumn', this._combineCollumn, this);\n        this.node.on('checkWin', this._checkWin, this);\n        this.node.on('checkLose', this._checkLose, this);\n    },\n\n    _checkWin: function () {\n        let win = false;\n        this._tilesMatrix.flat().forEach(element => {\n            element.getComponent('tilesScript').number === 2048 ? win = true : null;\n        })\n        win ? cc.log('you have won') : null;\n    },\n\n    _checkLose: function () {\n\n    },\n\n    _onClick: function () {\n        cc.log(this.getPosition(cc.v2()));\n        this.script = this.getComponent('tilesScript');\n        this.script.setNumber(this.script.number === 2 ? 4 : 2);\n    },\n\n    onLoad() {\n        cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN, this._onKeyDown, this);\n        this._setupGrid();\n        this._addEvent();\n\n\n    },\n\n    start() {\n\n    },\n\n    update(dt) {\n\n    },\n});\n"]}