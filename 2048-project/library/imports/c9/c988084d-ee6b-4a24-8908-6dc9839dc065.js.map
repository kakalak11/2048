{"version":3,"sources":["../../../../assets/script/assets/script/gameBoard.js"],"names":["Emitter","require","cc","Class","extends","Component","properties","tilePrefab","Prefab","_tilesMatrix","_moving","_onKeyDown","event","keyCode","macro","KEY","right","node","emit","left","_moveLeft","down","_moveDown","up","_moveUp","space","_generateRandomValue","_moveRight","forEach","element","rowIndex","numbers","filter","active","zeros","concat","collumnIndex","runAction","sequence","moveTo","callFunc","i","shift","collumn","j","push","_combineTile","log","randomCollumn","Math","floor","random","randomRow","every","randomTile","scale","setPosition","v2","scaleTo","_setupGrid","numberIndex","row","tile","instantiate","getComponent","setNumber","name","Number","String","getPosition","y","x","addChild","onLoad","systemEvent","on","SystemEvent","EventType","KEY_DOWN","start","update","dt"],"mappings":"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","file":"gameBoard.js","sourceRoot":"../../../../assets/script","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/class.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/class.html\n// Learn Attribute:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] https://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\n\nconst Emitter = require('event');\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        tilePrefab: cc.Prefab,\n        _tilesMatrix: [],\n        _moving: null,\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n\n    _onKeyDown: function (event) {\n        if (this._moving) return;\n        switch (event.keyCode) {\n            case cc.macro.KEY.right:\n                this._moving = true;\n                this.node.emit('right')\n                break;\n            case cc.macro.KEY.left:\n                this._moving = true;\n                this._moveLeft();\n                break;\n            case cc.macro.KEY.down:\n                this._moving = true;\n                this._moveDown();\n                break;\n            case cc.macro.KEY.up:\n                this._moving = true;\n                this._moveUp();\n                break;\n            case cc.macro.KEY.space:\n                this._generateRandomValue();\n                break;\n        }\n    },\n\n    _moveRight: function () {\n        this._tilesMatrix.forEach((element, rowIndex) => {\n            let numbers = element.filter(element => element.active);\n            let zeros = element.filter(element => !element.active);\n            element = zeros.concat(numbers);\n            element.forEach((element, collumnIndex) => element.runAction(cc.sequence(cc.moveTo(0.25, -157.5 + 105 * collumnIndex, 157.5 - 105 * rowIndex), cc.callFunc(() => {\n                this._moving = false;\n            }))));\n            for (let i = 0; i < 4; i++) {\n                this._tilesMatrix[rowIndex][i] = element.shift();\n            }\n        });\n        this.node.emit('move');\n        this.node.emit('combine')\n    },\n\n    _moveLeft: function () {\n        this._tilesMatrix.forEach((element, rowIndex) => {\n            let numbers = element.filter(element => element.active);\n            let zeros = element.filter(element => !element.active);\n            element = numbers.concat(zeros);\n            element.forEach((element, collumnIndex) => element.runAction(cc.sequence(cc.moveTo(0.25, -157.5 + 105 * collumnIndex, 157.5 - 105 * rowIndex), cc.callFunc(() => {\n                this._moving = false;\n            }))));\n            for (let i = 0; i < 4; i++) {\n                this._tilesMatrix[rowIndex][i] = element.shift();\n            }\n        });\n        this.node.emit('move');\n    },\n\n    _moveDown: function () {\n        for (let i = 0; i < 4; i++) {\n            let collumn = [];\n            for (let j = 0; j < 4; j++) {\n                collumn.push(this._tilesMatrix[j][i]);\n            }\n            let numbers = collumn.filter(element => element.active);\n            let zeros = collumn.filter(element => !element.active);\n            collumn = zeros.concat(numbers);\n            for (let j = 0; j < 4; j++) {\n                this._tilesMatrix[j][i] = collumn.shift();\n            }\n        }\n        this._tilesMatrix.forEach((element, rowIndex) => element.forEach((element, collumnIndex) => {\n            element.runAction(cc.moveTo(0.25, -157.5 + 105 * collumnIndex, 157.5 - 105 * rowIndex));\n            this._moving = false;\n        }));\n        this.node.emit('move');\n    },\n\n    _moveUp: function () {\n        for (let i = 0; i < 4; i++) {\n            let collumn = [];\n            for (let j = 0; j < 4; j++) {\n                collumn.push(this._tilesMatrix[j][i]);\n            }\n            let numbers = collumn.filter(element => element.active);\n            let zeros = collumn.filter(element => !element.active);\n            collumn = numbers.concat(zeros);\n            for (let j = 0; j < 4; j++) {\n                this._tilesMatrix[j][i] = collumn.shift();\n            }\n        }\n        this._tilesMatrix.forEach((element, rowIndex) => element.forEach((element, collumnIndex) => {\n            element.runAction(cc.moveTo(0.25, -157.5 + 105 * collumnIndex, 157.5 - 105 * rowIndex));\n            this._moving = false;\n        }));\n        this.node.emit('move');\n    },\n\n    _combineTile: function () {\n        cc.log('time to combine !!!');\n    },\n\n    _generateRandomValue() {\n        do {\n            this.randomCollumn = Math.floor(Math.random() * 4);\n            this.randomRow = Math.floor(Math.random() * 4);\n            // cc.log('generate a new random');\n            if (this._tilesMatrix.every(element => element.every(element => element.active))) {\n                return;\n            }\n        } while (this._tilesMatrix[this.randomRow][this.randomCollumn].active);\n        this.randomTile = this._tilesMatrix[this.randomRow][this.randomCollumn];\n        // cc.log(this.randomTile);\n        this.randomTile.active = true;\n        this.randomTile.scale = 0;\n        this.randomTile.setPosition(cc.v2(-157.5 + 105 * this.randomCollumn, 157.5 - 105 * this.randomRow));\n        this.randomTile.runAction(cc.scaleTo(0.25, 1));\n        // cc.log(this._tilesMatrix);\n    },\n\n    _setupGrid() {\n        let numberIndex = 1;\n        this._tilesMatrix.push([], [], [], []);\n        for (let collumn = 0; collumn < 4; collumn++) {\n            for (let row = 0; row < 4; row++) {\n                let tile = cc.instantiate(this.tilePrefab);\n                tile.active = Math.random() > 0.9 ? true : false;\n                tile.getComponent('tilesScript').setNumber(2);\n                tile.name = `tile ${numberIndex++}`;\n                tile.setPosition(cc.v2(-157.5 + 105 * row, 157.5 - 105 * collumn));\n                // cc.log(Number(String(tile.getPosition().x + 157.5)[0]), Number(String((tile.getPosition().y - 157.5) * -1)[0]));\n                this._tilesMatrix[Number(String((tile.getPosition().y - 157.5) * -1)[0])][Number(String(tile.getPosition().x + 157.5)[0])] = tile;\n                this.node.addChild(tile);\n            }\n        }\n    },\n\n    onLoad() {\n        cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN, this._onKeyDown, this);\n        this._setupGrid();\n        this.node.on('move', this._generateRandomValue, this);\n        this.node.on('right', this._moveRight, this);\n        this.node.on('combine', this._combineTile, this);\n\n        // this._tilesMatrix[0].forEach((element, index, array) => {\n        //     this.nextElement = array[index + 1];\n        //     cc.log(element, this.nextElement);\n        //     this.elementScript = element.getComponent('tilesScript');\n        //     if (this.nextElement) this.nextElementScript = this.nextElement.getComponent('tilesScript');\n        //     else return;\n        //     cc.log(this.elementScript.number, this.nextElementScript.number);\n        //     cc.log(this.elementScript.number === this.nextElementScript.number);\n        //     if (this.elementScript.number === this.nextElementScript.number) {\n        //         this.nextElementScript.setNumber(this.nextElementScript.number *= 2);\n        //         element.active = false;\n        //     }\n        // })\n    },\n\n    start() {\n    },\n\n    update(dt) {\n\n    },\n});\n"]}