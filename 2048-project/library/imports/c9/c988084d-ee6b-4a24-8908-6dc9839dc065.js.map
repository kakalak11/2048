{"version":3,"sources":["..\\..\\..\\..\\assets\\script/assets\\script\\gameBoard.js"],"names":["Emitter","require","cc","Class","extends","Component","properties","tilePrefab","Prefab","_tilesMatrix","_moving","_time","_check","_combined","_onKeyDown","event","keyCode","macro","KEY","right","d","node","emit","left","a","_moveLeft","down","s","_moveDown","up","w","_moveUp","space","log","_checkLose","_moveRight","forEach","element","rowIndex","numbers","filter","active","zeros","concat","collumnIndex","runAction","sequence","moveTo","callFunc","i","shift","scheduleOnce","collumn","j","push","_combineRow","directionRight","reverse","index","array","skip","nextElement","elementScript","getComponent","undefined","nextElementScript","number","copyTile","setNumber","scaleTo","action","moveBy","getPosition","v2","destroy","_generateRandomValue","_combineCollumn","directionDown","randomCollumn","Math","floor","random","randomRow","every","randomTile","scale","setPosition","_setupGrid","numberIndex","row","tile","instantiate","on","_onClick","name","Number","String","y","x","addChild","_addEvent","adjustRight","adjustDown","_checkWin","win","flat","checkRow","nextNumber","checkCollumn","script","onLoad","systemEvent","SystemEvent","EventType","KEY_DOWN","start","update","dt"],"mappings":"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","file":"gameBoard.js","sourceRoot":"..\\..\\..\\..\\assets\\script","sourcesContent":["// Learn cc.Class:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/class.html\r\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/class.html\r\n// Learn Attribute:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\r\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\r\n//  - [English] https://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\r\n\r\nconst Emitter = require('event');\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        tilePrefab: cc.Prefab,\r\n        _tilesMatrix: [],\r\n        _moving: null,\r\n        _time: 0.125,\r\n        _check: null,\r\n        _combined: false,\r\n    },\r\n\r\n    // LIFE-CYCLE CALLBACKS:\r\n\r\n    _onKeyDown: function (event) {\r\n        if (this._moving) return;\r\n        switch (event.keyCode) {\r\n            case cc.macro.KEY.right || cc.macro.KEY.d:\r\n                this._moving = true;\r\n                this.node.emit('right')\r\n                // this._moveRight();\r\n                break;\r\n            case cc.macro.KEY.left || cc.macro.KEY.a:\r\n                this._moving = true;\r\n                this._moveLeft();\r\n                break;\r\n            case cc.macro.KEY.down || cc.macro.KEY.s:\r\n                this._moving = true;\r\n                this._moveDown();\r\n                break;\r\n            case cc.macro.KEY.up || cc.macro.KEY.w:\r\n                this._moving = true;\r\n                this._moveUp();\r\n                break;\r\n            case cc.macro.KEY.space:\r\n                cc.log(this._checkLose());\r\n                break;\r\n        }\r\n    },\r\n\r\n    _moveRight: function () {\r\n        this._tilesMatrix.forEach((element, rowIndex) => {\r\n            let numbers = element.filter(element => element.active);\r\n            let zeros = element.filter(element => !element.active);\r\n            element = zeros.concat(numbers);\r\n            element.forEach((element, collumnIndex) => element.runAction(cc.sequence(cc.moveTo(this._time, -157.5 + 105 * collumnIndex, 157.5 - 105 * rowIndex), cc.callFunc(() => {\r\n            }))));\r\n            cc.log()\r\n            for (let i = 0; i < 4; i++) {\r\n                this._tilesMatrix[rowIndex][i] = element.shift();\r\n            }\r\n        });\r\n        this.scheduleOnce(() => {\r\n            this.node.emit('combineRow', true);\r\n            this.node.emit('move');\r\n\r\n        }, this._time);\r\n\r\n    },\r\n\r\n    _moveLeft: function () {\r\n        this._tilesMatrix.forEach((element, rowIndex) => {\r\n            let numbers = element.filter(element => element.active);\r\n            let zeros = element.filter(element => !element.active);\r\n            element = numbers.concat(zeros);\r\n            element.forEach((element, collumnIndex) => element.runAction(cc.sequence(cc.moveTo(this._time, -157.5 + 105 * collumnIndex, 157.5 - 105 * rowIndex), cc.callFunc(() => {\r\n            }))));\r\n            for (let i = 0; i < 4; i++) {\r\n                this._tilesMatrix[rowIndex][i] = element.shift();\r\n            }\r\n        });\r\n        this.scheduleOnce(() => {\r\n            this.node.emit('combineRow', false);\r\n            this.node.emit('move');\r\n\r\n        }, this._time);\r\n    },\r\n\r\n    _moveDown: function () {\r\n        for (let i = 0; i < 4; i++) {\r\n            let collumn = [];\r\n            for (let j = 0; j < 4; j++) {\r\n                collumn.push(this._tilesMatrix[j][i]);\r\n            }\r\n            let numbers = collumn.filter(element => element.active);\r\n            let zeros = collumn.filter(element => !element.active);\r\n            collumn = zeros.concat(numbers);\r\n            for (let j = 0; j < 4; j++) {\r\n                this._tilesMatrix[j][i] = collumn.shift();\r\n            }\r\n        }\r\n        this._tilesMatrix.forEach((element, rowIndex) => element.forEach((element, collumnIndex) => {\r\n            element.runAction(cc.moveTo(this._time, -157.5 + 105 * collumnIndex, 157.5 - 105 * rowIndex));\r\n\r\n        }));\r\n        this.scheduleOnce(() => {\r\n            this.node.emit('combineCollumn', true);\r\n            this.node.emit('move');\r\n        }, this._time);\r\n    },\r\n\r\n    _moveUp: function () {\r\n        for (let i = 0; i < 4; i++) {\r\n            let collumn = [];\r\n            for (let j = 0; j < 4; j++) {\r\n                collumn.push(this._tilesMatrix[j][i]);\r\n            }\r\n            let numbers = collumn.filter(element => element.active);\r\n            let zeros = collumn.filter(element => !element.active);\r\n            collumn = numbers.concat(zeros);\r\n            for (let j = 0; j < 4; j++) {\r\n                this._tilesMatrix[j][i] = collumn.shift();\r\n            }\r\n        }\r\n        this._tilesMatrix.forEach((element, rowIndex) => element.forEach((element, collumnIndex) => {\r\n            element.runAction(cc.moveTo(this._time, -157.5 + 105 * collumnIndex, 157.5 - 105 * rowIndex));\r\n\r\n        }));\r\n        this.scheduleOnce(() => {\r\n            this.node.emit('combineCollumn', false);\r\n            this.node.emit('move');\r\n        }, this._time);\r\n    },\r\n\r\n    //  2  -  2  -  2  - 0  => move =>  0  -  2  -  2  -  2  => reverse =>  2  -  2  -  2  -  0  => combine =>  4  -  0  -  2  -  0  => reverse \r\n\r\n    _combineRow: function (directionRight) {\r\n        if (directionRight) {\r\n            this._tilesMatrix.forEach(element => {\r\n                element.reverse().forEach((element, index, array) => {\r\n                    if (this.skip) {\r\n                        this.skip = false;\r\n                        return;\r\n                    }\r\n                    this.nextElement = array[index + 1];\r\n                    this.elementScript = element.getComponent('tilesScript');\r\n                    if (this.nextElement === undefined) return;\r\n                    this.nextElementScript = this.nextElement.getComponent('tilesScript');\r\n                    if (this.elementScript.number === this.nextElementScript.number) {\r\n                        this.skip = true;\r\n                        let copyTile = this.nextElement;\r\n                        this.elementScript.setNumber(this.elementScript.number *= 2);\r\n                        element.runAction(cc.sequence(cc.scaleTo(0.125, 1.25), cc.scaleTo(0.125, 1)));\r\n                        this.nextElement.active = false;\r\n                        this.nextElementScript.setNumber(0);\r\n                        let action = cc.sequence(\r\n                            cc.moveBy(0.125, element.getPosition(cc.v2())),\r\n                            cc.callFunc(() => {\r\n                                copyTile.destroy();\r\n                            }),\r\n                        );\r\n                        copyTile.runAction(action);\r\n                        // this.node.emit('position-changed');\r\n                        this._combined = true;\r\n                    }\r\n                });\r\n                element.reverse();\r\n            });\r\n            if (this._combined && !this._check) {\r\n                this._check = true;\r\n                // this._generateRandomValue();\r\n                this._combined = false;\r\n            }\r\n            this.node.emit('adjustRow', true);\r\n            return;\r\n        }\r\n\r\n        this._tilesMatrix.forEach(element => {\r\n            element.forEach((element, index, array) => {\r\n                if (this.skip) {\r\n                    this.skip = false;\r\n                    return;\r\n                }\r\n                this.nextElement = array[index + 1];\r\n                this.elementScript = element.getComponent('tilesScript');\r\n                if (this.nextElement === undefined) return;\r\n                this.nextElementScript = this.nextElement.getComponent('tilesScript');\r\n                if (this.elementScript.number === this.nextElementScript.number) {\r\n                    this.skip = true;\r\n                    let copyTile = this.nextElement;\r\n                    this.elementScript.setNumber(this.elementScript.number *= 2);\r\n                    element.runAction(cc.sequence(cc.scaleTo(0.125, 1.25), cc.scaleTo(0.125, 1)));\r\n                    this.nextElement.active = false;\r\n                    this.nextElementScript.setNumber(0);\r\n                    let action = cc.sequence(\r\n                        cc.moveBy(0.125, element.getPosition(cc.v2())),\r\n                        cc.callFunc(() => {\r\n                            copyTile.destroy();\r\n                        }),\r\n                    );\r\n                    copyTile.runAction(action);\r\n                    // this.node.emit('position-changed');\r\n                    this._combined = true;\r\n                }\r\n            });\r\n        });\r\n        if (this._combined && !this._check) {\r\n            this._check = true;\r\n            this._generateRandomValue();\r\n            this._combined = false;\r\n        }\r\n        this.node.emit('adjustRow', false);\r\n        return;\r\n    },\r\n\r\n    _combineCollumn: function (directionDown) {\r\n        if (directionDown) {\r\n            for (let i = 0; i < 4; i++) {\r\n                this.collumn = [];\r\n                for (let j = 0; j < 4; j++) {\r\n                    this.collumn.push(this._tilesMatrix[j][i]);\r\n                }\r\n                this.collumn.reverse().forEach((element, index, array) => {\r\n                    if (this.skip) {\r\n                        this.skip = false;\r\n                        return;\r\n                    }\r\n                    this.nextElement = array[index + 1];\r\n                    this.elementScript = element.getComponent('tilesScript');\r\n                    if (this.nextElement === undefined) return;\r\n                    this.nextElementScript = this.nextElement.getComponent('tilesScript');\r\n                    if (this.elementScript.number === this.nextElementScript.number) {\r\n                        this.skip = true;\r\n                        let copyTile = this.nextElement;\r\n                        this.elementScript.setNumber(this.elementScript.number *= 2);\r\n                        element.runAction(cc.sequence(cc.scaleTo(0.125, 1.25), cc.scaleTo(0.125, 1)));\r\n                        this.nextElement.active = false;\r\n                        this.nextElementScript.setNumber(0);\r\n                        let action = cc.sequence(\r\n                            cc.moveTo(0.125, element.getPosition(cc.v2())),\r\n                            cc.callFunc(() => {\r\n                                copyTile.destroy();\r\n\r\n                            }),\r\n                        );\r\n                        copyTile.runAction(action);\r\n                        // this.node.emit('position-changed');\r\n\r\n                    }\r\n                });\r\n                this.collumn.reverse();\r\n            }\r\n            this.node.emit('adjustCollumn', true);\r\n            return;\r\n        }\r\n\r\n\r\n\r\n        for (let i = 0; i < 4; i++) {\r\n            this.collumn = [];\r\n            for (let j = 0; j < 4; j++) {\r\n                this.collumn.push(this._tilesMatrix[j][i]);\r\n            }\r\n            this.collumn.forEach((element, index, array) => {\r\n                if (this.skip) {\r\n                    this.skip = false;\r\n                    return;\r\n                }\r\n                this.nextElement = array[index + 1];\r\n                this.elementScript = element.getComponent('tilesScript');\r\n                if (this.nextElement === undefined) return;\r\n                this.nextElementScript = this.nextElement.getComponent('tilesScript');\r\n                if (this.elementScript.number === this.nextElementScript.number) {\r\n                    this.skip = true;\r\n                    let copyTile = this.nextElement;\r\n                    // copyTile.setPosition(element.getPosition(cc.v2()));\r\n                    this.elementScript.setNumber(this.elementScript.number *= 2);\r\n                    element.runAction(cc.sequence(cc.scaleTo(0.125, 1.25), cc.scaleTo(0.125, 1)));\r\n                    this.nextElement.active = false;\r\n                    this.nextElementScript.setNumber(0);\r\n                    let action = cc.sequence(\r\n                        cc.moveTo(0.125, element.getPosition(cc.v2())),\r\n                        cc.callFunc(() => {\r\n                            copyTile.destroy();\r\n                        }),\r\n                    );\r\n                    copyTile.runAction(action);\r\n                    // this.node.emit('position-changed');\r\n                }\r\n            });\r\n        }\r\n        this.node.emit('adjustCollumn', false);\r\n        return;\r\n    },\r\n\r\n    _generateRandomValue() {\r\n        if (!this._check) return;\r\n        do {\r\n            this.randomCollumn = Math.floor(Math.random() * 4);\r\n            this.randomRow = Math.floor(Math.random() * 4);\r\n            if (this._tilesMatrix.every(element => element.every(element => element.active))) {\r\n                this.node.emit('checkLose');\r\n                return;\r\n            }\r\n        } while (this._tilesMatrix[this.randomRow][this.randomCollumn].active);\r\n        this.randomTile = this._tilesMatrix[this.randomRow][this.randomCollumn];\r\n        this.number = this.randomTile.getComponent('tilesScript');\r\n        this.randomTile.active = true;\r\n        this.randomTile.scale = 0;\r\n        this.number.setNumber(Math.random() > 0.7 ? 4 : 2);\r\n        this.randomTile.setPosition(cc.v2(-157.5 + 105 * this.randomCollumn, 157.5 - 105 * this.randomRow));\r\n        this.randomTile.runAction(cc.sequence(cc.scaleTo(this._time, 1), cc.callFunc(() => this._check = false)));\r\n    },\r\n\r\n    _setupGrid() {\r\n        let numberIndex = 1;\r\n        this._tilesMatrix.push([], [], [], []);\r\n        for (let collumn = 0; collumn < 4; collumn++) {\r\n            for (let row = 0; row < 4; row++) {\r\n                this.tile = cc.instantiate(this.tilePrefab);\r\n                this.tile.active = false;\r\n                this.tile.on('mousedown', this._onClick, this.tile);\r\n                // tile.active ? tile.getComponent('tilesScript').setNumber(Math.random() > 0.5 ? 2 : 4) : tile.getComponent('tilesScript').setNumber(0);\r\n                this.tile.name = `tile ${numberIndex++}`;\r\n                this.tile.setPosition(cc.v2(-157.5 + 105 * row, 157.5 - 105 * collumn));\r\n                this.tile.on('position-changed', () => this._check = true, this);\r\n                this._tilesMatrix[Number(String((this.tile.getPosition().y - 157.5) * -1)[0])][Number(String(this.tile.getPosition().x + 157.5)[0])] = this.tile;\r\n                this.node.addChild(this.tile);\r\n            }\r\n        }\r\n        this._check = true;\r\n        for (let i = 0; i < 2; i++) this._generateRandomValue();\r\n        this._check = false;\r\n    },\r\n\r\n    _addEvent: function () {\r\n        this.node.on('move', this._generateRandomValue, this);\r\n        this.node.on('right', this._moveRight, this);\r\n        this.node.on('adjustRow', (adjustRight) => {\r\n            this._tilesMatrix.forEach((element, rowIndex) => {\r\n                let numbers = element.filter(element => element.active);\r\n                let zeros = element.filter(element => !element.active);\r\n                adjustRight ? element = zeros.concat(numbers) : element = numbers.concat(zeros);\r\n                element.forEach((element, collumnIndex) => element.runAction(cc.sequence(cc.moveTo(this._time, -157.5 + 105 * collumnIndex, 157.5 - 105 * rowIndex), cc.callFunc(() => {\r\n                    this._moving = false;\r\n                }))));\r\n                for (let i = 0; i < 4; i++) {\r\n                    this._tilesMatrix[rowIndex][i] = element.shift();\r\n                }\r\n            });\r\n            this.node.emit('checkWin');\r\n        }, this);\r\n        this.node.on('adjustCollumn', (adjustDown) => {\r\n            for (let i = 0; i < 4; i++) {\r\n                let collumn = [];\r\n                for (let j = 0; j < 4; j++) {\r\n                    collumn.push(this._tilesMatrix[j][i]);\r\n                }\r\n                let numbers = collumn.filter(element => element.active);\r\n                let zeros = collumn.filter(element => !element.active);\r\n                adjustDown ? collumn = zeros.concat(numbers) : collumn = numbers.concat(zeros);\r\n                for (let j = 0; j < 4; j++) {\r\n                    this._tilesMatrix[j][i] = collumn.shift();\r\n                }\r\n            }\r\n            this._tilesMatrix.forEach((element, rowIndex) => element.forEach((element, collumnIndex) => {\r\n                element.runAction(cc.moveTo(this._time, -157.5 + 105 * collumnIndex, 157.5 - 105 * rowIndex));\r\n                this._moving = false;\r\n            }));\r\n            this.node.emit('checkWin');\r\n        });\r\n        this.node.on('combineRow', this._combineRow, this);\r\n        this.node.on('combineCollumn', this._combineCollumn, this);\r\n        this.node.on('checkWin', this._checkWin, this);\r\n        this.node.on('checkLose', this._checkLose, this);\r\n    },\r\n\r\n    _checkWin: function () {\r\n        let win = false;\r\n        this._tilesMatrix.flat().forEach(element => {\r\n            element.getComponent('tilesScript').number === 2048 ? win = true : null;\r\n        })\r\n        win ? cc.log('you have won') : null;\r\n        return;\r\n    },\r\n\r\n    _checkLose: function () {\r\n        this.checkRow = this._tilesMatrix.every((element, index, array) => {\r\n            if (element.every((element, index, array) => {\r\n                if (array[index + 1] === undefined) return true;\r\n                this.number = element.getComponent('tilesScript').number;\r\n                this.nextNumber = array[index + 1].getComponent('tilesScript').number;\r\n                if (this.number !== this.nextNumber) return true;\r\n                return false;\r\n            })) return true;\r\n            return false;\r\n        });\r\n        this.checkCollumn = this._tilesMatrix.flat().every((element, index, array) => {\r\n            if (array[index + 4] === undefined) return true;\r\n            this.number = element.getComponent('tilesScript').number;\r\n            this.nextNumber = array[index + 4].getComponent('tilesScript').number;\r\n            if (this.number !== this.nextNumber) return true;\r\n            return false;\r\n        });\r\n        if (this.checkCollumn && this.checkRow) return true;\r\n        return false;\r\n    },\r\n\r\n    _onClick: function () {\r\n        cc.log(this.getPosition(cc.v2()));\r\n        this.script = this.getComponent('tilesScript');\r\n        this.script.setNumber(this.script.number === 2 ? 4 : 2);\r\n    },\r\n\r\n    onLoad() {\r\n        cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN, this._onKeyDown, this);\r\n        this._setupGrid();\r\n        this._addEvent();\r\n    },\r\n\r\n    start() {\r\n\r\n    },\r\n\r\n    update(dt) {\r\n\r\n    },\r\n});\r\n"]}