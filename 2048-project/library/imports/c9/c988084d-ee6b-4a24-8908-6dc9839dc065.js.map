{"version":3,"sources":["../../../../assets/script/assets/script/gameBoard.js"],"names":["Emitter","require","cc","Class","extends","Component","properties","tilePrefab","Prefab","_tilesMatrix","_moving","_time","_check","_combined","_posistionChanged","_skip","_onKeyDown","event","node","emit","keyCode","macro","KEY","d","_moveRow","_combineRow","scheduleOnce","_adjustPosition","a","s","_moveCollumn","_combineCollumn","w","space","console","clear","c","_generateRandomValue","directionRight","forEach","element","rowIndex","numbers","filter","active","zeros","concat","i","shift","directionDown","adjust","collumn","j","push","collumnIndex","action","sequence","moveTo","easing","easeSineIn","callFunc","runAction","dispatchEvent","Event","EventCustom","index","array","reverse","skip","nextElement","elementScript","getComponent","undefined","nextElementScript","number","setNumber","scaleTo","moveCombine","getPosition","v2","randomCollumn","Math","floor","random","randomRow","flat","every","randomTile","scale","setPosition","_setupGrid","playing","numberIndex","row","tile","instantiate","name","on","Number","String","y","x","addChild","_checkWin","win","log","_checkLose","checkRow","nextNumber","checkCollumn","_onClick","script","onLoad","systemEvent","SystemEvent","EventType","KEY_DOWN","start","update","dt"],"mappings":"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","file":"gameBoard.js","sourceRoot":"../../../../assets/script","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/class.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/class.html\n// Learn Attribute:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] https://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\n\nconst Emitter = require('event');\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        tilePrefab: cc.Prefab,\n        _tilesMatrix: [],\n        _moving: null,\n        _time: 0.25 / 8,\n        _check: true,\n        _combined: false,\n        _posistionChanged: null,\n        _skip: false,\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n\n    _onKeyDown: function (event) {\n        this.node.emit('checkWin');\n        this.node.emit('checkLose');\n        if (this._moving) return;\n        this._moving = true;\n        this._check = false;\n        switch (event.keyCode) {\n            case cc.macro.KEY.d:\n                this._moveRow(true);\n                this._combineRow(true);\n                this.scheduleOnce(() => {\n                    this._moveRow(true);\n                    this._adjustPosition();\n                    this._moving = false;\n                }, this._time);\n                break;\n            case cc.macro.KEY.a:\n                this._moveRow(false);\n                this._combineRow(false);\n                this.scheduleOnce(() => {\n                    this._moveRow(false);\n                    this._adjustPosition();\n                    this._moving = false;\n                }, this._time);\n                break;\n            case cc.macro.KEY.s:\n                this._moveCollumn(true);\n                this._combineCollumn(true);\n                this.scheduleOnce(() => {\n                    this._moveCollumn(true);\n                    this._adjustPosition();\n                    this._moving = false;\n                }, this._time);\n                break;\n            case cc.macro.KEY.w:\n                this._moveCollumn(false);\n                this._combineCollumn(false);\n                this.scheduleOnce(() => {\n                    this._moveCollumn(false);\n                    this._adjustPosition();\n                    this._moving = false;\n                }, this._time);\n                break;\n            case cc.macro.KEY.space:\n                this._adjustPosition();\n                console.clear();\n                break;\n            case cc.macro.KEY.c:\n                this._generateRandomValue();\n                break;\n            default:\n                this._moving = false;\n                break;\n        }\n    },\n\n    //Move logic\n\n    _moveRow: function (directionRight) {\n        this._tilesMatrix.forEach((element, rowIndex) => {\n            let numbers = element.filter(element => element.active);\n            let zeros = element.filter(element => !element.active);\n            directionRight ? element = zeros.concat(numbers) : element = numbers.concat(zeros);\n            for (let i = 0; i < 4; i++) this._tilesMatrix[rowIndex][i] = element.shift();\n        });\n        return;\n    },\n\n    _moveCollumn: function (directionDown, adjust) {\n        for (let i = 0; i < 4; i++) {\n            let collumn = [];\n            for (let j = 0; j < 4; j++) collumn.push(this._tilesMatrix[j][i]);\n            let numbers = collumn.filter(element => element.active);\n            let zeros = collumn.filter(element => !element.active);\n            directionDown ? collumn = zeros.concat(numbers) : collumn = numbers.concat(zeros);\n            for (let j = 0; j < 4; j++) this._tilesMatrix[j][i] = collumn.shift();\n        }\n        return;\n    },\n\n    _adjustPosition: function () {\n        this._tilesMatrix.forEach((element, rowIndex) => element.forEach((element, collumnIndex) => {\n            this.action = cc.sequence(\n                cc.moveTo(this._time, -157.5 + 105 * collumnIndex, 157.5 - 105 * rowIndex).easing(cc.easeSineIn(this._time)),\n                cc.callFunc(() => { }),\n            );\n            element.runAction(this.action);\n        }));\n        this.node.dispatchEvent(new cc.Event.EventCustom('updateScore', true));\n        this.scheduleOnce(this._generateRandomValue, this._time);\n        return;\n    },\n\n    //Combine logic\n\n    _combineRow: function (directionRight) {\n        this._tilesMatrix.forEach((element, index) => {\n            directionRight ? this.array = element.reverse() : this.array = element;\n            this.array.forEach((element, index, array) => {\n                if (this.skip) {\n                    this.skip = false;\n                    return;\n                }\n                this.nextElement = array[index + 1];\n                this.elementScript = element.getComponent('tilesScript');\n                if (this.nextElement === undefined) return;\n                this.nextElementScript = this.nextElement.getComponent('tilesScript');\n                if (this.elementScript.number === 0) return;\n                if (this.elementScript.number === this.nextElementScript.number) {\n                    this.skip = true;\n                    this.elementScript.setNumber(this.elementScript.number *= 2);\n                    element.runAction(cc.sequence(cc.scaleTo(this._time / 2, 1.25), cc.scaleTo(this._time / 2, 1)));\n                    this.nextElementScript.moveCombine(element.getPosition(cc.v2()), this._time / 2);\n                    this._combined = true;\n                }\n            });\n            directionRight ? this.array.reverse() : null;\n        });\n        return;\n    },\n\n    _combineCollumn: function (directionDown) {\n        for (let i = 0; i < 4; i++) {\n            this.collumn = [];\n            for (let j = 0; j < 4; j++) {\n                this.collumn.push(this._tilesMatrix[j][i]);\n            }\n            directionDown ? this.collumn.reverse() : null;\n            this.collumn.forEach((element, index, array) => {\n                if (this.skip) {\n                    this.skip = false;\n                    return;\n                }\n                this.nextElement = array[index + 1];\n                this.elementScript = element.getComponent('tilesScript');\n                if (this.nextElement === undefined) return;\n                this.nextElementScript = this.nextElement.getComponent('tilesScript');\n                if (this.elementScript.number === 0) return;\n                if (this.elementScript.number === this.nextElementScript.number) {\n                    this.skip = true;\n                    this.elementScript.setNumber(this.elementScript.number *= 2);\n                    element.runAction(cc.sequence(cc.scaleTo(this._time / 2, 1.25), cc.scaleTo(this._time / 2, 1)));\n                    this.nextElementScript.moveCombine(element.getPosition(cc.v2()), this._time);\n                    this._combined = true;\n                }\n            });\n            directionDown ? this.collumn.reverse() : null;\n        }\n        return;\n    },\n\n    _generateRandomValue() {\n        if (!this._check) return;\n        do {\n            this.randomCollumn = Math.floor(Math.random() * 4);\n            this.randomRow = Math.floor(Math.random() * 4);\n            if (this._tilesMatrix.flat().every(element => element.active)) {\n                return;\n            }\n        } while (this._tilesMatrix[this.randomRow][this.randomCollumn].active);\n        this.randomTile = this._tilesMatrix[this.randomRow][this.randomCollumn];\n        this.number = this.randomTile.getComponent('tilesScript');\n        this.randomTile.active = true;\n        this.randomTile.scale = 0;\n        this.number.setNumber(Math.random() > 0.7 ? 4 : 2);\n        this.randomTile.setPosition(cc.v2(-157.5 + 105 * this.randomCollumn, 157.5 - 105 * this.randomRow));\n        this.randomTile.runAction(cc.scaleTo(this._time, 1));\n        this._check = false;\n    },\n\n    _setupGrid(playing) {\n        let numberIndex = 1;\n        this._tilesMatrix.push([], [], [], []);\n        for (let collumn = 0; collumn < 4; collumn++) {\n            for (let row = 0; row < 4; row++) {\n                this.tile = cc.instantiate(this.tilePrefab);\n                this.tile.active = false;\n                // this.tile.on('mousedown', this._onClick, this.tile);\n                this.tile.name = `tile ${numberIndex++}`;\n                this.tile.setPosition(cc.v2(-157.5 + 105 * row, 157.5 - 105 * collumn));\n                this.tile.on('position-changed', () => {\n                    // cc.log('position changed');\n                    this._check = true;\n                }, this);\n                this._tilesMatrix[Number(String((this.tile.getPosition().y - 157.5) * -1)[0])][Number(String(this.tile.getPosition().x + 157.5)[0])] = this.tile;\n                this.node.addChild(this.tile);\n            }\n        }\n        if (playing) return;\n        for (let i = 0; i < 2; i++) {\n            this._check = true;\n            this._generateRandomValue();\n        }\n        this._check = false;\n    },\n\n    _checkWin: function () {\n        let win = false;\n        this._tilesMatrix.flat().forEach(element => element.getComponent('tilesScript').number === 2048 ? win = true : null);\n        if (win) {\n            cc.log('you have won');\n            this.node.dispatchEvent(new cc.Event.EventCustom('win', true));\n            return true;\n        }\n        return false;\n    },\n\n    _checkLose: function () {\n        this.checkRow = this._tilesMatrix.every((element, index, array) => {\n            if (element.every((element, index, array) => {\n                if (array[index + 1] === undefined) return true;\n                this.number = element.getComponent('tilesScript').number;\n                this.nextNumber = array[index + 1].getComponent('tilesScript').number;\n                if (this.number !== this.nextNumber) return true;\n                return false;\n            })) return true;\n            return false;\n        });\n        this.checkCollumn = this._tilesMatrix.flat().every((element, index, array) => {\n            if (array[index + 4] === undefined) return true;\n            this.number = element.getComponent('tilesScript').number;\n            this.nextNumber = array[index + 4].getComponent('tilesScript').number;\n            if (this.number !== this.nextNumber) return true;\n            return false;\n        });\n        if (this.checkCollumn && this.checkRow) {\n            cc.log('you have lost');\n            this.node.dispatchEvent(new cc.Event.EventCustom('lose', true));\n            return true;\n        }\n        return false;\n    },\n\n    _onClick: function () {\n        cc.log(this.name);\n        this.script = this.getComponent('tilesScript');\n        // this.script.setNumber(this.script.number === 2 ? 4 : 2);\n        this.script.setNumber(2048);\n        return;\n        cc.log(this.getPosition(cc.v2()));\n    },\n\n    onLoad() {\n        cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN, this._onKeyDown, this);\n        this.node.on('checkWin', this._checkWin, this);\n        this.node.on('checkLose', this._checkLose, this);\n    },\n\n    start() {\n    },\n\n    update(dt) {\n    },\n});\n"]}