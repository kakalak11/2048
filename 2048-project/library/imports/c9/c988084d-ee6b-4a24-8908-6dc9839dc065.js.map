{"version":3,"sources":["../../../../assets/script/assets/script/gameBoard.js"],"names":["Emitter","require","cc","Class","extends","Component","properties","tilePrefab","Prefab","_tilesMatrix","_moving","_time","_onKeyDown","event","log","keyCode","macro","KEY","right","d","node","emit","left","a","_moveLeft","down","s","_moveDown","up","w","_moveUp","space","_generateRandomValue","v","_moveRight","forEach","element","rowIndex","numbers","filter","active","zeros","concat","collumnIndex","runAction","sequence","moveTo","callFunc","i","shift","scheduleOnce","collumn","j","push","_combineRow","directionRight","index","array","skip","nextElement","elementScript","getComponent","undefined","nextElementScript","number","copyTile","setNumber","scaleTo","action","moveBy","destroy","reverse","_combineCollumn","directionDown","randomCollumn","Math","floor","random","randomRow","every","randomTile","scale","setPosition","v2","_setupGrid","numberIndex","row","tile","instantiate","on","_onClick","name","Number","String","getPosition","y","x","addChild","script","onLoad","systemEvent","SystemEvent","EventType","KEY_DOWN","adjustRight","start","update","dt"],"mappings":"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","file":"gameBoard.js","sourceRoot":"../../../../assets/script","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/class.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/class.html\n// Learn Attribute:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] https://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\n\nconst Emitter = require('event');\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        tilePrefab: cc.Prefab,\n        _tilesMatrix: [],\n        _moving: null,\n        _time: 0.125\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n\n    _onKeyDown: function (event) {\n        cc.log('move');\n        if (this._moving) return;\n        switch (event.keyCode) {\n            case cc.macro.KEY.right || cc.macro.KEY.d:\n                this._moving = true;\n                this.node.emit('right')\n                // this._moveRight();\n                break;\n            case cc.macro.KEY.left || cc.macro.KEY.a:\n                this._moving = true;\n                this._moveLeft();\n                break;\n            case cc.macro.KEY.down || cc.macro.KEY.s:\n                this._moving = true;\n                this._moveDown();\n                break;\n            case cc.macro.KEY.up || cc.macro.KEY.w:\n                this._moving = true;\n                this._moveUp();\n                break;\n            case cc.macro.KEY.space:\n                this._generateRandomValue();\n                break;\n            case cc.macro.KEY.v:\n\n                break;\n        }\n    },\n\n    _moveRight: function () {\n        this._tilesMatrix.forEach((element, rowIndex) => {\n            let numbers = element.filter(element => element.active);\n            let zeros = element.filter(element => !element.active);\n            element = zeros.concat(numbers);\n            element.forEach((element, collumnIndex) => element.runAction(cc.sequence(cc.moveTo(this._time, -157.5 + 105 * collumnIndex, 157.5 - 105 * rowIndex), cc.callFunc(() => {\n                cc.log('this run later');\n            }))));\n            for (let i = 0; i < 4; i++) {\n                this._tilesMatrix[rowIndex][i] = element.shift();\n            }\n        });\n        this.scheduleOnce(() => {\n            cc.log('this run first');\n            this.node.emit('combineRow', true);\n            this.node.emit('move');\n            this._moving = false;\n        }, this._time);\n\n    },\n\n    _moveLeft: function () {\n        this._tilesMatrix.forEach((element, rowIndex) => {\n            let numbers = element.filter(element => element.active);\n            let zeros = element.filter(element => !element.active);\n            element = numbers.concat(zeros);\n            element.forEach((element, collumnIndex) => element.runAction(cc.sequence(cc.moveTo(this._time, -157.5 + 105 * collumnIndex, 157.5 - 105 * rowIndex), cc.callFunc(() => {\n                this._moving = false;\n            }))));\n            for (let i = 0; i < 4; i++) {\n                this._tilesMatrix[rowIndex][i] = element.shift();\n            }\n        });\n        this.scheduleOnce(() => {\n            this.node.emit('combineRow', false);\n            this.node.emit('move');\n        }, this._time);\n    },\n\n    _moveDown: function () {\n        for (let i = 0; i < 4; i++) {\n            let collumn = [];\n            for (let j = 0; j < 4; j++) {\n                collumn.push(this._tilesMatrix[j][i]);\n            }\n            let numbers = collumn.filter(element => element.active);\n            let zeros = collumn.filter(element => !element.active);\n            collumn = zeros.concat(numbers);\n            for (let j = 0; j < 4; j++) {\n                this._tilesMatrix[j][i] = collumn.shift();\n            }\n        }\n        this._tilesMatrix.forEach((element, rowIndex) => element.forEach((element, collumnIndex) => {\n            element.runAction(cc.moveTo(this._time, -157.5 + 105 * collumnIndex, 157.5 - 105 * rowIndex));\n            this._moving = false;\n        }));\n        this.scheduleOnce(() => {\n            this.node.emit('combineCollumn', true);\n            this.node.emit('move');\n        }, this._time);\n    },\n\n    _moveUp: function () {\n        for (let i = 0; i < 4; i++) {\n            let collumn = [];\n            for (let j = 0; j < 4; j++) {\n                collumn.push(this._tilesMatrix[j][i]);\n            }\n            let numbers = collumn.filter(element => element.active);\n            let zeros = collumn.filter(element => !element.active);\n            collumn = numbers.concat(zeros);\n            for (let j = 0; j < 4; j++) {\n                this._tilesMatrix[j][i] = collumn.shift();\n            }\n        }\n        this._tilesMatrix.forEach((element, rowIndex) => element.forEach((element, collumnIndex) => {\n            element.runAction(cc.moveTo(this._time, -157.5 + 105 * collumnIndex, 157.5 - 105 * rowIndex));\n            this._moving = false;\n        }));\n        this.scheduleOnce(() => {\n            this.node.emit('combineCollumn', false);\n            this.node.emit('move');\n        }, this._time);\n    },\n\n    _combineRow: function (directionRight) {\n        cc.log('time to combine !!!');\n        if (directionRight) {\n            this._tilesMatrix.forEach(element => {\n                element.forEach((element, index, array) => {\n                    if (this.skip) {\n                        this.skip = false;\n                        return;\n                    }\n                    // cc.log(element, this.nextElement);\n                    this.nextElement = array[index + 1];\n                    this.elementScript = element.getComponent('tilesScript');\n                    if (this.nextElement !== undefined) this.nextElementScript = this.nextElement.getComponent('tilesScript');\n                    else return;\n                    // cc.log('this still run', index);\n                    // cc.log(this.elementScript.number, this.nextElementScript.number);\n                    // cc.log(this.elementScript.number === this.nextElementScript.number);\n                    if (this.elementScript.number === this.nextElementScript.number) {\n                        this.skip = true;\n                        let copyTile = element;\n                        cc.log(copyTile);\n                        this.nextElementScript.setNumber(this.nextElementScript.number *= 2);\n                        this.nextElement.runAction(cc.sequence(cc.scaleTo(0.125, 1.25), cc.scaleTo(0.125, 1)));\n                        element.active = false;\n                        this.elementScript.setNumber(0);\n                        let action = cc.sequence(\n                            cc.moveBy(0.125, 105, 0),\n                            cc.callFunc(() => {\n                                copyTile.destroy();\n                            }),\n                        );\n                        copyTile.runAction(action);\n\n                    }\n                });\n            });\n\n            this.node.emit('adjust', true);\n            return;\n        }\n\n        this._tilesMatrix.forEach(element => {\n            element.reverse().forEach((element, index, array) => {\n                // cc.log(element);\n                if (this.skip) {\n                    this.skip = false;\n                    return;\n                }\n                cc.log(element, this.nextElement);\n                this.nextElement = array[index + 1];\n                this.elementScript = element.getComponent('tilesScript');\n                if (this.nextElement !== undefined) this.nextElementScript = this.nextElement.getComponent('tilesScript');\n                else return;\n                // cc.log(this.elementScript.number, this.nextElementScript.number);\n                // cc.log(this.elementScript.number === this.nextElementScript.number);\n                if (this.elementScript.number === this.nextElementScript.number) {\n                    this.skip = true;\n                    let copyTile = element;\n                    cc.log(copyTile);\n                    this.nextElementScript.setNumber(this.nextElementScript.number *= 2);\n                    this.nextElement.runAction(cc.sequence(cc.scaleTo(0.125, 1.25), cc.scaleTo(0.125, 1)));\n                    element.active = false;\n                    this.elementScript.setNumber(0);\n                    let action = cc.sequence(\n                        cc.moveBy(0.125, -105, 0),\n                        cc.callFunc(() => {\n                            copyTile.destroy();\n                        }),\n                    );\n                    copyTile.runAction(action);\n                }\n            });\n            element.reverse();\n        });\n        this.node.emit('adjust', false);\n        return;\n    },\n\n    _combineCollumn: function (directionDown) {\n        if (directionDown) {\n            for (let i = 0; i < 4; i++) {\n                this.collumn = [];\n                for (let j = 0; j < 4; j++) {\n                    this.collumn.push(this._tilesMatrix[j][i]);\n                }\n                i === 3 ? cc.log(this.collumn) : null;\n                this.collumn.forEach((element, index, array) => {\n                    if (this.skip || array[index + 1] === undefined) {\n                        this.skip = false;\n                        return;\n                    }\n                    this.nextElement = array[index + 1];\n                    this.elementScript = element.getComponent('tilesScript');\n                    if (this.nextElement !== undefined) this.nextElementScript = this.nextElement.getComponent('tilesScript');\n                    else return;\n                    // cc.log(this.elementScript.number, this.nextElementScript.number);\n                    // cc.log(this.elementScript.number === this.nextElementScript.number);\n                    if (this.elementScript.number === this.nextElementScript.number) {\n                        this.skip = true;\n                        let copyTile = element;\n                        cc.log(copyTile);\n                        this.nextElementScript.setNumber(this.nextElementScript.number *= 2);\n                        this.nextElement.runAction(cc.sequence(cc.scaleTo(0.125, 1.25), cc.scaleTo(0.125, 1)));\n                        element.active = false;\n                        this.elementScript.setNumber(0);\n                        let action = cc.sequence(\n                            cc.moveBy(0.125, 0, -105),\n                            cc.callFunc(() => {\n                                copyTile.destroy();\n                            }),\n                        );\n                        copyTile.runAction(action);\n                        // element.active = false;\n                    }\n                    return;\n                });\n            }\n            return;\n        }\n\n        for (let i = 0; i < 4; i++) {\n            this.collumn = [];\n            for (let j = 0; j < 4; j++) {\n                this.collumn.push(this._tilesMatrix[j][i]);\n            }\n            cc.log(this.collumn.reverse());\n            this.collumn.forEach((element, index, array) => {\n                if (this.skip) {\n                    this.skip = false;\n                    return;\n                }\n                this.nextElement = array[index + 1];\n                this.elementScript = element.getComponent('tilesScript');\n                if (this.nextElement !== undefined) this.nextElementScript = this.nextElement.getComponent('tilesScript');\n                else return;\n                // cc.log(this.elementScript.number, this.nextElementScript.number);\n                // cc.log(this.elementScript.number === this.nextElementScript.number);\n                if (this.elementScript.number === this.nextElementScript.number) {\n                    this.skip = true;\n                    let copyTile = element;\n                    cc.log(copyTile);\n                    this.nextElementScript.setNumber(this.nextElementScript.number *= 2);\n                    this.nextElement.runAction(cc.sequence(cc.scaleTo(0.125, 1.25), cc.scaleTo(0.125, 1)));\n                    element.active = false;\n                    this.elementScript.setNumber(0);\n                    let action = cc.sequence(\n                        cc.moveBy(0.125, 0, -105),\n                        cc.callFunc(() => {\n                            copyTile.destroy();\n                        }),\n                    );\n                    copyTile.runAction(action);\n                    // element.active = false;\n                    this.skip = true;\n                }\n            });\n            this.collumn.reverse();\n        }\n    },\n\n    _generateRandomValue() {\n        cc.log(this._tilesMatrix);\n        do {\n            this.randomCollumn = Math.floor(Math.random() * 4);\n            this.randomRow = Math.floor(Math.random() * 4);\n            if (this._tilesMatrix.every(element => element.every(element => element.active))) {\n                return;\n            }\n        } while (this._tilesMatrix[this.randomRow][this.randomCollumn].active);\n        this.randomTile = this._tilesMatrix[this.randomRow][this.randomCollumn];\n        this.number = this.randomTile.getComponent('tilesScript');\n        this.randomTile.active = true;\n        this.randomTile.scale = 0;\n        this.number.setNumber(Math.random() > 0.7 ? 4 : 2);\n        this.randomTile.setPosition(cc.v2(-157.5 + 105 * this.randomCollumn, 157.5 - 105 * this.randomRow));\n        this.randomTile.runAction(cc.scaleTo(this._time, 1));\n    },\n\n    _setupGrid() {\n        let numberIndex = 1;\n        this._tilesMatrix.push([], [], [], []);\n        for (let collumn = 0; collumn < 4; collumn++) {\n            for (let row = 0; row < 4; row++) {\n                let tile = cc.instantiate(this.tilePrefab);\n                tile.active = Math.random() > 0.9 ? true : false;\n                tile.on('mousedown', this._onClick, tile);\n                tile.active ? tile.getComponent('tilesScript').setNumber(Math.random() > 0.5 ? 2 : 4) : tile.getComponent('tilesScript').setNumber(0);\n                tile.name = `tile ${numberIndex++}`;\n                tile.setPosition(cc.v2(-157.5 + 105 * row, 157.5 - 105 * collumn));\n                this._tilesMatrix[Number(String((tile.getPosition().y - 157.5) * -1)[0])][Number(String(tile.getPosition().x + 157.5)[0])] = tile;\n                this.node.addChild(tile);\n            }\n        }\n    },\n\n    _onClick: function () {\n        this.script = this.getComponent('tilesScript');\n        this.script.setNumber(2);\n    },\n\n    onLoad() {\n        cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN, this._onKeyDown, this);\n        this._setupGrid();\n        this.node.on('move', this._generateRandomValue, this);\n        this.node.on('right', this._moveRight, this);\n        this.node.on('adjust', (adjustRight) => {\n            this._tilesMatrix.forEach((element, rowIndex) => {\n                let numbers = element.filter(element => element.active);\n                let zeros = element.filter(element => !element.active);\n                adjustRight ? element = zeros.concat(numbers) : element = numbers.concat(zeros);\n                element.forEach((element, collumnIndex) => element.runAction(cc.sequence(cc.moveTo(this._time, -157.5 + 105 * collumnIndex, 157.5 - 105 * rowIndex), cc.callFunc(() => {\n                    cc.log('this run later');\n                }))));\n                cc.log(this._tilesMatrix);\n            });\n        }, this);\n        this.node.on('combineRow', this._combineRow, this);\n        this.node.on('combineCollumn', this._combineCollumn, this);\n\n        // this.node.on('mousedown', this._onClick, this);\n    },\n\n    start() {\n    },\n\n    update(dt) {\n\n    },\n});\n"]}