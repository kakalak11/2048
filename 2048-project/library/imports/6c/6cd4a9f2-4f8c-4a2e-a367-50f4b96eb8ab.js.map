{"version":3,"sources":["../../../../../assets/scenes/testScript/assets/scenes/testScript/prefabScript.js"],"names":["Emitter","require","cc","Class","extends","Component","properties","nodeSprite","Node","nodeLabel","Label","_pos","Vec2","_index","_time","_moving","number","_setPosition","start","node","setPosition","opacity","once","dispatchEvent","Event","EventCustom","log","action","sequence","moveTo","v2","callFunc","runAction","_setActive","data","Math","random","string","scaleTo","setNumber","_getCombine","key","_setCombine","pos","onLoad","instance","registerEvent","bind"],"mappings":"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","file":"prefabScript.js","sourceRoot":"../../../../../assets/scenes/testScript","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/class.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/class.html\n// Learn Attribute:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] https://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\n\nconst Emitter = require('mEmitter');\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        nodeSprite: cc.Node,\n        nodeLabel: cc.Label,\n        _pos: cc.Vec2,\n        _index: null,\n        _time: 0.25,\n        _moving: null,\n        number: 0,\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n\n    _setPosition: function (start) {\n        if (this._moving) return;\n        if (start) {\n            this.node.setPosition(this._pos);\n            return;\n        }\n        if (this.node.opacity === 0) {\n            this.node.setPosition(this._pos);\n            return;\n        }\n        this.node.once('position-changed', () => {\n            this.node.dispatchEvent(new cc.Event.EventCustom('moved', true));\n            cc.log('pos change');\n        }, this);\n        this._moving = true;\n        this.action = cc.sequence(\n            cc.moveTo(this._time, cc.v2(this._pos)),\n            cc.callFunc(() => {\n                this._moving = false;\n                this.node.dispatchEvent(new cc.Event.EventCustom('canMove', true));\n                this.node.dispatchEvent(new cc.Event.EventCustom('stop', true));\n            })\n        );\n        this.node.runAction(this.action);\n        return;\n    },\n\n    _setActive: function (data = null) {\n        if (data !== this._index || this.node.opacity !== 0) return;\n        this.node.opacity = 255;\n        this.number = Math.random() > 0.5 ? 2 : 4;\n        this.nodeLabel.string = this.number;\n        let action = cc.sequence(\n            cc.scaleTo(this._time / 2, 1.2),\n            cc.callFunc(() => {\n            }),\n            cc.scaleTo(this._time / 2, 1),\n        );\n        this.node.runAction(action);\n        return;\n    },\n\n    setNumber: function (number) {\n        this.number = number;\n        this.nodeLabel.string = this.number;\n        return;\n    },\n\n    _getCombine: function (data) {\n        if (data.key !== this._index) return;\n        // cc.log('this is the one get combine', data.key);\n        this.number *= 2;\n        this.nodeLabel.string = this.number;\n        let action = cc.sequence(\n            cc.scaleTo(this._time / 2, 1.2),\n            cc.callFunc(() => {\n            }),\n            cc.scaleTo(this._time / 2, 1),\n        );\n        this.node.runAction(action);\n        return;\n    },\n\n    _setCombine: function (data) {\n        if (data.key !== this._index) return;\n        this.number = 0;\n        this.node.opacity = 0;\n        this.nodeLabel.string = this.number;\n        let action = cc.sequence(\n            cc.moveTo(this._time, data.pos),\n            cc.callFunc(() => {\n                this.node.setPosition(this._pos);\n            }),\n        );\n        this.node.runAction(action);\n        return;\n    },\n\n    onLoad() {\n        Emitter.instance.registerEvent('setPosition', this._setPosition.bind(this));\n        Emitter.instance.registerEvent('setActive', this._setActive.bind(this));\n\n        Emitter.instance.registerEvent('getCombine', this._getCombine.bind(this));\n        Emitter.instance.registerEvent('setCombine', this._setCombine.bind(this));\n    },\n\n    start() {\n\n    },\n\n    // update(dt) {},\n});\n"]}