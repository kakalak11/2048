{"version":3,"sources":["test.js"],"names":["Emitter","require","cc","Class","extends","Component","properties","nodePrefab","Prefab","_canMove","_tileArray","_moved","_createTile","number","push","index","row","collumn","tile","instantiate","opacity","name","node","addChild","script","getComponent","xPos","yPos","_pos","v2","_index","i","random","Math","floor","flat","instance","emit","_onKeyDown","event","keyCode","macro","KEY","d","_moveRow","_combineRow","_generateRandomtile","a","w","_moveCollumn","_combineCollumn","s","_onClick","setNumber","moveRight","forEach","element","numbers","filter","zeros","concat","x","shift","moveDown","y","combineRight","reverse","array","skip","currentScript","undefined","nextElement","nextScript","key","pos","combineDown","currentElement","every","_addEvent","registerEvent","bind","on","log","stopPropagation","onLoad","systemEvent","SystemEvent","EventType","KEY_DOWN","start","update","dt"],"mappings":"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","file":"test.js","sourceRoot":"../../../../../assets/scenes/testScript","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/class.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/class.html\n// Learn Attribute:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] https://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\n\nconst Emitter = require('mEmitter');\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        nodePrefab: cc.Prefab,\n        _canMove: true,\n        _tileArray: [],\n        _moved: true,\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n\n    _createTile: function (number) {\n        this._tileArray.push([], [], [], []);\n        let index = 0;\n        for (let row = 0; row < number; row++) {\n            for (let collumn = 0; collumn < number; collumn++) {\n                this.tile = cc.instantiate(this.nodePrefab);\n                this.tile.opacity = 0;\n                this.tile.name = `tile ${index + 1}`;\n                // this.tile.on('mousedown', this._onClick, this.tile);\n                this.node.addChild(this.tile);\n                this._tileArray[row].push(this.tile);\n                this.script = this.tile.getComponent('prefabScript');\n                this.xPos = -157.5 + collumn * 105;\n                this.yPos = 157.5 - row * 105;\n                this.script._pos = cc.v2(this.xPos, this.yPos);\n                this.script._index = index;\n                index++;\n            }\n        }\n        for (let i = 0; i < 2; i++) {\n            do {\n                this.random = Math.floor(Math.random() * 16);\n            } while (this._tileArray.flat()[this.random].opacity !== 0)\n            Emitter.instance.emit('setActive', this.random);\n        }\n        Emitter.instance.emit('setPosition', true);\n    },\n\n    _onKeyDown: function (event) {\n        if (!this._canMove) return;\n        this._canMove = false;\n        switch (event.keyCode) {\n            case cc.macro.KEY.d:\n                this._moveRow(true);\n                this._combineRow(true);\n                this._moveRow(true);\n                Emitter.instance.emit('setPosition');\n                this._generateRandomtile();\n                break;\n            case cc.macro.KEY.a:\n                this._moveRow(false);\n                this._combineRow(false);\n                this._moveRow(false);\n                Emitter.instance.emit('setPosition');\n                this._generateRandomtile();\n                break;\n            case cc.macro.KEY.w:\n                this._moveCollumn(false);\n                this._combineCollumn(false);\n                this._moveCollumn(false);\n                Emitter.instance.emit('setPosition');\n                this._generateRandomtile();\n                break;\n            case cc.macro.KEY.s:\n                this._moveCollumn(true);\n                this._combineCollumn(true);\n                this._moveCollumn(true);\n                Emitter.instance.emit('setPosition');\n                this._generateRandomtile();\n                break;\n            default:\n                this._canMove = true;\n                break;\n        }\n    },\n\n    _onClick: function () {\n        if (!this.opacity) return;\n        this.script = this.getComponent('prefabScript');\n        this.script.number === 2 ? this.script.setNumber(4) : this.script.setNumber(2);\n    },\n\n    _moveRow: function (moveRight) {\n        this._tileArray.forEach((element, index) => {\n            this.numbers = element.filter(element => element.opacity !== 0);\n            this.zeros = element.filter(element => element.opacity === 0);\n            moveRight ? element = this.zeros.concat(this.numbers) : element = this.numbers.concat(this.zeros);\n            element.forEach((element, index) => {\n                this.script = element.getComponent('prefabScript');\n                this.script._pos.x = -157.5 + index * 105;\n            });\n            for (let collumn = 0; collumn < 4; collumn++) this._tileArray[index][collumn] = element.shift();\n        });\n    },\n\n    _moveCollumn: function (moveDown) {\n        for (let collumn = 0; collumn < 4; collumn++) {\n            this.collumn = [];\n            for (let row = 0; row < 4; row++) this.collumn.push(this._tileArray[row][collumn]);\n            this.numbers = this.collumn.filter(element => element.opacity !== 0);\n            this.zeros = this.collumn.filter(element => element.opacity === 0);\n            moveDown ? this.collumn = this.zeros.concat(this.numbers) : this.collumn = this.numbers.concat(this.zeros);\n            this.collumn.forEach((element, index) => {\n                this.script = element.getComponent('prefabScript');\n                this.script._pos.y = 157.5 - index * 105;\n            });\n            for (let row = 0; row < 4; row++)this._tileArray[row][collumn] = this.collumn.shift();\n        }\n    },\n\n    _combineRow: function (combineRight) {\n        this._tileArray.forEach((element, row) => {\n            combineRight ? element.reverse() : element;\n            element.forEach((element, index, array) => {\n                if (this.skip) {\n                    this.skip = false;\n                    return;\n                }\n                this.currentScript = element.getComponent('prefabScript');\n                if (array[index + 1] === undefined) return;\n                this.nextElement = array[index + 1];\n                this.nextScript = this.nextElement.getComponent('prefabScript');\n                if (this.nextScript.number === 0 || this.currentScript === 0) return;\n                if (this.currentScript.number === this.nextScript.number) {\n                    Emitter.instance.emit('getCombine', { key: this.currentScript._index });\n                    Emitter.instance.emit('setCombine', { key: this.nextScript._index, pos: this.currentScript._pos });\n                    this.skip = true;\n                    return;\n                }\n            });\n            combineRight ? element.reverse() : null;\n        });\n    },\n\n    _combineCollumn: function (combineDown) {\n        for (let collumn = 0; collumn < 4; collumn++) {\n            this.collumn = [];\n            for (let row = 0; row < 4; row++)this.collumn.push(this._tileArray[row][collumn]);\n            combineDown ? this.collumn.reverse() : this.collumn;\n            this.collumn.forEach((element, index, array) => {\n                if (this.skip) {\n                    this.skip = false;\n                    return;\n                }\n                this.currentElement = element;\n                this.currentScript = this.currentElement.getComponent('prefabScript');\n                if (array[index + 1] === undefined) return;\n                this.nextElement = array[index + 1];\n                this.nextScript = this.nextElement.getComponent('prefabScript');\n                if (this.nextScript.number === 0 || this.currentScript === 0) return;\n                if (this.currentScript.number === this.nextScript.number) {\n                    Emitter.instance.emit('getCombine', { key: this.currentScript._index });\n                    Emitter.instance.emit('setCombine', { key: this.nextScript._index, pos: this.currentScript._pos })\n                    this.skip = true;\n                    return;\n                }\n            });\n            combineDown ? this.collumn.reverse() : null;\n        }\n    },\n\n    _generateRandomtile: function () {\n        if (!this._moved) return;\n        do {\n            this.random = Math.floor(Math.random() * 16);\n            if (this._tileArray.flat().every(element => element.opacity !== 0)) {\n                return;\n            }\n        } while (this._tileArray.flat()[this.random].opacity !== 0);\n        this.script = this._tileArray.flat()[this.random].getComponent('prefabScript');\n        Emitter.instance.emit('setActive', this.script._index);\n        this._moved = false;\n        return;\n    },\n\n    _addEvent: function () {\n        Emitter.instance.registerEvent('setPosition', this._generateRandomtile.bind(this));\n        this.node.on('moved', () => {\n            this._moved = true;\n            cc.log('move');\n        }, this);\n        this.node.on('canMove', (event) => {\n            event.stopPropagation();\n            this._canMove = true;\n        }, this);\n    },\n\n    onLoad() {\n        cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN, this._onKeyDown, this);\n        Emitter.instance = new Emitter();\n        this._createTile(4);\n        this._addEvent();\n\n    },\n\n    start() {\n\n    },\n\n    update(dt) {\n\n    },\n});\n"]}