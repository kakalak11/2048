{"version":3,"sources":["gameBoard.js"],"names":["Emitter","require","cc","Class","extends","Component","properties","tilePrefab","Prefab","_tilesMatrix","_moving","_time","_check","_combined","_posistionChanged","_skip","_onKeyDown","event","keyCode","macro","KEY","d","_moveRow","a","s","_moveCollumn","w","space","_adjustPosition","console","clear","directionRight","adjust","forEach","element","rowIndex","numbers","filter","active","zeros","concat","i","shift","_combineRow","_generateRandomValue","scheduleOnce","node","emit","directionDown","collumn","j","push","_combineCollumn","collumnIndex","action","sequence","moveTo","easing","easeCubicActionInOut","callFunc","runAction","index","array","reverse","skip","nextElement","elementScript","getComponent","undefined","nextElementScript","number","copyTile","setNumber","scaleTo","moveBy","getPosition","v2","destroy","bypass","warn","log","randomCollumn","Math","floor","random","randomRow","every","randomTile","scale","setPosition","_setupGrid","numberIndex","row","tile","instantiate","on","_onClick","name","Number","String","y","x","addChild","_addEvent","adjustRight","adjustDown","_checkWin","_checkLose","win","flat","checkRow","nextNumber","checkCollumn","script","onLoad","systemEvent","SystemEvent","EventType","KEY_DOWN","start","update","dt"],"mappings":"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","file":"gameBoard.js","sourceRoot":"../../../../assets/script","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/class.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/class.html\n// Learn Attribute:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] https://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\n\nconst Emitter = require('event');\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        tilePrefab: cc.Prefab,\n        _tilesMatrix: [],\n        _moving: null,\n        _time: 0.25,\n        _check: true,\n        _combined: false,\n        _posistionChanged: null,\n        _skip: false,\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n\n    _onKeyDown: function (event) {\n        if (this._moving) return;\n        this._moving = true;\n        switch (event.keyCode) {\n            case cc.macro.KEY.d:\n                this._moveRow(true);\n                break;\n            case cc.macro.KEY.a:\n                this._moveRow(false);\n                break;\n            case cc.macro.KEY.s:\n                this._moveCollumn(true);\n                break;\n            case cc.macro.KEY.w:\n                this._moveCollumn(false);\n                break;\n            case cc.macro.KEY.space:\n                this._adjustPosition();\n                console.clear();\n                break;\n            default:\n                this._moving = false;\n                break;\n        }\n    },\n\n    _moveRow: function (directionRight, adjust) {\n        this._tilesMatrix.forEach((element, rowIndex) => {\n            let numbers = element.filter(element => element.active);\n            let zeros = element.filter(element => !element.active);\n            directionRight ? element = zeros.concat(numbers) : element = numbers.concat(zeros);\n            for (let i = 0; i < 4; i++) this._tilesMatrix[rowIndex][i] = element.shift();\n        });\n        if (!adjust) this._combineRow(directionRight);\n        this._adjustPosition();\n        if (adjust) this._generateRandomValue();\n\n        return;\n        this.scheduleOnce(() => {\n            this.node.emit('move');\n        }, this._time);\n    },\n\n    _moveCollumn: function (directionDown, adjust) {\n        for (let i = 0; i < 4; i++) {\n            let collumn = [];\n            for (let j = 0; j < 4; j++) collumn.push(this._tilesMatrix[j][i]);\n            let numbers = collumn.filter(element => element.active);\n            let zeros = collumn.filter(element => !element.active);\n            directionDown ? collumn = zeros.concat(numbers) : collumn = numbers.concat(zeros);\n            for (let j = 0; j < 4; j++) this._tilesMatrix[j][i] = collumn.shift();\n        }\n        if (!adjust) this._combineCollumn(directionDown);\n        this._adjustPosition();\n        if (adjust) this._generateRandomValue();\n\n        return;\n        this.scheduleOnce(() => {\n            this.node.emit('combineCollumn', directionDown);\n            this.node.emit('move');\n        }, this._time);\n    },\n\n    _adjustPosition: function () {\n        this._tilesMatrix.forEach((element, rowIndex) => element.forEach((element, collumnIndex) => {\n            this.action = cc.sequence(\n                cc.moveTo(this._time / 2, -157.5 + 105 * collumnIndex, 157.5 - 105 * rowIndex).easing(cc.easeCubicActionInOut(this._time / 2)),\n                cc.callFunc(() => this._moving = false),\n            );\n            element.runAction(this.action);\n        }));\n        return;\n    },\n\n    _combineRow: function (directionRight) {\n        this._tilesMatrix.forEach((element, index) => {\n            directionRight ? this.array = element.reverse() : this.array = element;\n            this.array.forEach((element, index, array) => {\n                if (this.skip) {\n                    this.skip = false;\n                    return;\n                }\n                this.nextElement = array[index + 1];\n                this.elementScript = element.getComponent('tilesScript');\n                if (this.nextElement === undefined) return;\n                this.nextElementScript = this.nextElement.getComponent('tilesScript');\n                if (this.elementScript.number === 0) return;\n                if (this.elementScript.number === this.nextElementScript.number) {\n                    this.skip = true;\n                    let copyTile = this.nextElement;\n                    this.elementScript.setNumber(this.elementScript.number *= 2);\n                    element.runAction(cc.sequence(cc.scaleTo(this._time / 2, 1.25), cc.scaleTo(this._time / 2, 1)));\n                    this.nextElement.active = false;\n                    this.nextElementScript.setNumber(0);\n                    let action = cc.sequence(\n                        cc.moveBy(this._time, element.getPosition(cc.v2())),\n                        cc.callFunc(() => {\n                            copyTile.destroy();\n                        }),\n                    );\n                    copyTile.runAction(action);\n                    this._combined = true;\n                }\n            });\n            directionRight ? this.array.reverse() : null;\n        });\n        this.scheduleOnce(() => this._moveRow(directionRight, true), this._time / 2);\n        this._combined && !this._check ? this._generateRandomValue(true) : this._combined = false;\n        return;\n    },\n\n    //  2  -  2  -  2  - 0  => move =>  0  -  2  -  2  -  2  => reverse =>  2  -  2  -  2  -  0  => combine =>  4  -  0  -  2  -  0  => reverse \n\n    _combineCollumn: function (directionDown) {\n        for (let i = 0; i < 4; i++) {\n            this.collumn = [];\n            for (let j = 0; j < 4; j++) {\n                this.collumn.push(this._tilesMatrix[j][i]);\n            }\n            directionDown ? this.collumn.reverse() : null;\n            this.collumn.forEach((element, index, array) => {\n                if (this.skip) {\n                    this.skip = false;\n                    return;\n                }\n                this.nextElement = array[index + 1];\n                this.elementScript = element.getComponent('tilesScript');\n                if (this.nextElement === undefined) return;\n                this.nextElementScript = this.nextElement.getComponent('tilesScript');\n                if (this.elementScript.number === 0) return;\n                if (this.elementScript.number === this.nextElementScript.number) {\n                    this.skip = true;\n                    let copyTile = this.nextElement;\n                    this.elementScript.setNumber(this.elementScript.number *= 2);\n                    element.runAction(cc.sequence(cc.scaleTo(this._time / 2, 1.25), cc.scaleTo(this._time / 2, 1)));\n                    this.nextElement.active = false;\n                    this.nextElementScript.setNumber(0);\n                    let action = cc.sequence(\n                        cc.moveTo(this._time, element.getPosition(cc.v2())),\n                        cc.callFunc(() => {\n                            copyTile.destroy();\n                        }),\n                    );\n                    copyTile.runAction(action);\n                    // this.node.emit('position-changed');\n                    this._combined = true;\n\n                }\n            });\n            directionDown ? this.collumn.reverse() : null;\n        }\n        this.scheduleOnce(() => this._moveCollumn(directionDown, true), this._time / 2);\n        this._combined && !this._check ? this._generateRandomValue(true) : this._combined = false;\n        return;\n    },\n\n    _generateRandomValue(bypass = false) {\n        if (this._skip) {\n            this._skip = false;\n            this._check = false;\n            return;\n        }\n        cc.warn('bypass is ', bypass);\n        cc.warn('check is ', this._check);\n        if (bypass) {\n            this._check = true;\n            this._skip = bypass;\n        }\n        cc.log('===========');\n        if (!this._check) return;\n        do {\n            this.randomCollumn = Math.floor(Math.random() * 4);\n            this.randomRow = Math.floor(Math.random() * 4);\n            if (this._tilesMatrix.every(element => element.every(element => element.active))) {\n                this.node.emit('checkLose');\n                return;\n            }\n        } while (this._tilesMatrix[this.randomRow][this.randomCollumn].active);\n        this.randomTile = this._tilesMatrix[this.randomRow][this.randomCollumn];\n        this.number = this.randomTile.getComponent('tilesScript');\n        this.randomTile.active = true;\n        this.randomTile.scale = 0;\n        this.number.setNumber(Math.random() > 0.7 ? 4 : 2);\n        this.randomTile.setPosition(cc.v2(-157.5 + 105 * this.randomCollumn, 157.5 - 105 * this.randomRow));\n        this.randomTile.runAction(cc.sequence(cc.scaleTo(this._time, 1), cc.callFunc(() => null)));\n        // this.scheduleOnce(() => this._check = false, this._time);\n        this._check = false;\n        this._combined = false;\n    },\n\n    _setupGrid() {\n        let numberIndex = 1;\n        this._tilesMatrix.push([], [], [], []);\n        for (let collumn = 0; collumn < 4; collumn++) {\n            for (let row = 0; row < 4; row++) {\n                this.tile = cc.instantiate(this.tilePrefab);\n                this.tile.active = false;\n                this.tile.on('mousedown', this._onClick, this.tile);\n                // tile.active ? tile.getComponent('tilesScript').setNumber(Math.random() > 0.5 ? 2 : 4) : tile.getComponent('tilesScript').setNumber(0);\n                this.tile.name = `tile ${numberIndex++}`;\n                this.tile.setPosition(cc.v2(-157.5 + 105 * row, 157.5 - 105 * collumn));\n                this.tile.on('position-changed', () => {\n                    if (this._check) return;\n                    this._check = true;\n                }, this);\n                this._tilesMatrix[Number(String((this.tile.getPosition().y - 157.5) * -1)[0])][Number(String(this.tile.getPosition().x + 157.5)[0])] = this.tile;\n                this.node.addChild(this.tile);\n            }\n        }\n        for (let i = 0; i < 2; i++) {\n            this._check = true;\n            this._generateRandomValue();\n        }\n        this._check = false;\n    },\n\n    _addEvent: function () {\n        // this.node.on('move', this._generateRandomValue, this);\n        this.node.on('adjustRow', (adjustRight) => {\n            this._tilesMatrix.forEach((element, rowIndex) => {\n                let numbers = element.filter(element => element.active);\n                let zeros = element.filter(element => !element.active);\n                adjustRight ? element = zeros.concat(numbers) : element = numbers.concat(zeros);\n                element.forEach((element, collumnIndex) => element.runAction(cc.sequence(cc.moveTo(this._time, -157.5 + 105 * collumnIndex, 157.5 - 105 * rowIndex), cc.callFunc(() => {\n                }))));\n                for (let i = 0; i < 4; i++) {\n                    this._tilesMatrix[rowIndex][i] = element.shift();\n                }\n            });\n            this.node.emit('checkWin');\n        }, this);\n        this.node.on('adjustCollumn', (adjustDown) => {\n            for (let i = 0; i < 4; i++) {\n                let collumn = [];\n                for (let j = 0; j < 4; j++) {\n                    collumn.push(this._tilesMatrix[j][i]);\n                }\n                let numbers = collumn.filter(element => element.active);\n                let zeros = collumn.filter(element => !element.active);\n                adjustDown ? collumn = zeros.concat(numbers) : collumn = numbers.concat(zeros);\n                for (let j = 0; j < 4; j++) {\n                    this._tilesMatrix[j][i] = collumn.shift();\n                }\n            }\n            this._tilesMatrix.forEach((element, rowIndex) => element.forEach((element, collumnIndex) => {\n                element.runAction(cc.moveTo(this._time, -157.5 + 105 * collumnIndex, 157.5 - 105 * rowIndex));\n            }));\n            this.node.emit('checkWin');\n        });\n        this.node.on('combineRow', this._combineRow, this);\n        this.node.on('combineCollumn', this._combineCollumn, this);\n        this.node.on('checkWin', this._checkWin, this);\n        this.node.on('checkLose', this._checkLose, this);\n    },\n\n    _checkWin: function () {\n        // !this._combined && this._check ? this._check = false : null;\n        // cc.log(this._check);\n        this._combined && !this._check ? this._generateRandomValue(true) : null;\n        this._check ? this._generateRandomValue() : null;\n        this._check && !this._combined ? this._check = false : null;\n        this._combined = false;\n        // this._check ? this._check = false : null;\n        let win = false;\n        this._tilesMatrix.flat().forEach(element => {\n            element.getComponent('tilesScript').number === 2048 ? win = true : null;\n        })\n        win ? cc.log('you have won') : null;\n        return;\n    },\n\n    _checkLose: function () {\n        this.checkRow = this._tilesMatrix.every((element, index, array) => {\n            if (element.every((element, index, array) => {\n                if (array[index + 1] === undefined) return true;\n                this.number = element.getComponent('tilesScript').number;\n                this.nextNumber = array[index + 1].getComponent('tilesScript').number;\n                if (this.number !== this.nextNumber) return true;\n                return false;\n            })) return true;\n            return false;\n        });\n        this.checkCollumn = this._tilesMatrix.flat().every((element, index, array) => {\n            if (array[index + 4] === undefined) return true;\n            this.number = element.getComponent('tilesScript').number;\n            this.nextNumber = array[index + 4].getComponent('tilesScript').number;\n            if (this.number !== this.nextNumber) return true;\n            cc.log('you lose')\n            return false;\n        });\n        if (this.checkCollumn && this.checkRow) return true;\n        return false;\n    },\n\n    _onClick: function () {\n        cc.log(this.name);\n        this.script = this.getComponent('tilesScript');\n        this.script.setNumber(this.script.number === 2 ? 4 : 2);\n        return;\n        cc.log(this.getPosition(cc.v2()));\n    },\n\n    onLoad() {\n        cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN, this._onKeyDown, this);\n        this._setupGrid();\n        this._addEvent();\n    },\n\n    start() {\n\n        // this.schedule(() => console.clear(), 1);\n    },\n\n    update(dt) {\n        // cc.log('check is ', this._check);\n    },\n});\n"]}