{"version":3,"sources":["gameBoard.js"],"names":["Emitter","require","cc","Class","extends","Component","properties","tilePrefab","Prefab","winBoard","Node","loseBoard","swipeSound","AudioSource","_tilesMatrix","_moving","_time","_check","_combined","_posistionChanged","_skip","_onKeyDown","event","node","emit","play","keyCode","macro","KEY","d","_moveRow","_combineRow","scheduleOnce","_adjustPosition","a","s","_moveCollumn","_combineCollumn","w","c","dispatchEvent","Event","EventCustom","space","console","clear","directionRight","forEach","element","rowIndex","numbers","filter","active","zeros","concat","i","shift","directionDown","adjust","collumn","j","push","index","array","reverse","skip","nextElement","elementScript","getComponent","undefined","nextElementScript","number","setNumber","runAction","sequence","scaleTo","moveCombine","getPosition","v2","collumnIndex","lastPos","action","moveTo","callFunc","currentPos","Math","abs","floor","x","y","log","name","setPosition","_generateRandomValue","randomCollumn","random","randomRow","flat","every","randomTile","scale","_setupGrid","playing","systemEvent","on","SystemEvent","EventType","KEY_DOWN","numberIndex","row","tile","instantiate","_onClick","Number","String","addChild","_checkWin","win","off","_checkLose","checkRow","nextNumber","checkCollumn","_reset","children","splice","script","onLoad","stopPropagation","start","update","dt"],"mappings":"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","file":"gameBoard.js","sourceRoot":"..\\..\\..\\..\\assets\\script","sourcesContent":["// Learn cc.Class:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/class.html\r\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/class.html\r\n// Learn Attribute:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\r\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\r\n//  - [English] https://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\r\n\r\nconst Emitter = require('event');\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        tilePrefab: cc.Prefab,\r\n        winBoard: cc.Node,\r\n        loseBoard: cc.Node,\r\n        swipeSound: cc.AudioSource,\r\n        _tilesMatrix: [],\r\n        _moving: null,\r\n        _time: 0.25 / 8,\r\n        _check: true,\r\n        _combined: false,\r\n        _posistionChanged: null,\r\n        _skip: false,\r\n    },\r\n\r\n    // LIFE-CYCLE CALLBACKS:\r\n\r\n    _onKeyDown: function (event) {\r\n        this.node.emit('checkWin');\r\n        this.node.emit('checkLose');\r\n        if (this._moving) return;\r\n        this.swipeSound.play();\r\n        this._moving = true;\r\n        this._check = false;\r\n        switch (event.keyCode) {\r\n            case cc.macro.KEY.d:\r\n                this._moveRow(true);\r\n                this._combineRow(true);\r\n                this.scheduleOnce(() => {\r\n                    this._moveRow(true);\r\n                    this._adjustPosition();\r\n                    this._moving = false;\r\n                }, this._time);\r\n                break;\r\n            case cc.macro.KEY.a:\r\n                this._moveRow(false);\r\n                this._combineRow(false);\r\n                this.scheduleOnce(() => {\r\n                    this._moveRow(false);\r\n                    this._adjustPosition();\r\n                    this._moving = false;\r\n                }, this._time);\r\n                break;\r\n            case cc.macro.KEY.s:\r\n                this._moveCollumn(true);\r\n                this._combineCollumn(true);\r\n                this.scheduleOnce(() => {\r\n                    this._moveCollumn(true);\r\n                    this._adjustPosition();\r\n                    this._moving = false;\r\n                }, this._time);\r\n                break;\r\n            case cc.macro.KEY.w:\r\n                this._moveCollumn(false);\r\n                this._combineCollumn(false);\r\n                this.scheduleOnce(() => {\r\n                    this._moveCollumn(false);\r\n                    this._adjustPosition();\r\n                    this._moving = false;\r\n                }, this._time);\r\n                break;\r\n            case cc.macro.KEY.c:\r\n                this.node.dispatchEvent(new cc.Event.EventCustom('lose', true));\r\n                break;\r\n            case cc.macro.KEY.space:\r\n                console.clear();\r\n                this._moving = false;\r\n                break;\r\n            default:\r\n                this._moving = false;\r\n                break;\r\n        }\r\n    },\r\n\r\n    //Move logic\r\n\r\n    _moveRow: function (directionRight) {\r\n        this._tilesMatrix.forEach((element, rowIndex) => {\r\n            let numbers = element.filter(element => element.active);\r\n            let zeros = element.filter(element => !element.active);\r\n            directionRight ? element = zeros.concat(numbers) : element = numbers.concat(zeros);\r\n            for (let i = 0; i < 4; i++) this._tilesMatrix[rowIndex][i] = element.shift();\r\n        });\r\n        return;\r\n    },\r\n\r\n    _moveCollumn: function (directionDown, adjust) {\r\n        for (let i = 0; i < 4; i++) {\r\n            let collumn = [];\r\n            for (let j = 0; j < 4; j++) collumn.push(this._tilesMatrix[j][i]);\r\n            let numbers = collumn.filter(element => element.active);\r\n            let zeros = collumn.filter(element => !element.active);\r\n            directionDown ? collumn = zeros.concat(numbers) : collumn = numbers.concat(zeros);\r\n            for (let j = 0; j < 4; j++) this._tilesMatrix[j][i] = collumn.shift();\r\n        }\r\n        return;\r\n    },\r\n\r\n    //Combine logic\r\n\r\n    _combineRow: function (directionRight) {\r\n        this._tilesMatrix.forEach((element, index) => {\r\n            directionRight ? this.array = element.reverse() : this.array = element;\r\n            this.array.forEach((element, index, array) => {\r\n                if (this.skip) {\r\n                    this.skip = false;\r\n                    return;\r\n                }\r\n                this.nextElement = array[index + 1];\r\n                this.elementScript = element.getComponent('tilesScript');\r\n                if (this.nextElement === undefined) return;\r\n                this.nextElementScript = this.nextElement.getComponent('tilesScript');\r\n                if (this.elementScript.number === 0) return;\r\n                if (this.elementScript.number === this.nextElementScript.number) {\r\n                    this.skip = true;\r\n                    this.elementScript.setNumber(this.elementScript.number *= 2);\r\n                    element.runAction(cc.sequence(cc.scaleTo(this._time / 2, 1.25), cc.scaleTo(this._time / 2, 1)));\r\n                    this.nextElementScript.moveCombine(element.getPosition(cc.v2()), this._time / 2);\r\n                    this._combined = true;\r\n                }\r\n            });\r\n            directionRight ? this.array.reverse() : null;\r\n        });\r\n        return;\r\n    },\r\n\r\n    _combineCollumn: function (directionDown) {\r\n        for (let i = 0; i < 4; i++) {\r\n            this.collumn = [];\r\n            for (let j = 0; j < 4; j++) {\r\n                this.collumn.push(this._tilesMatrix[j][i]);\r\n            }\r\n            directionDown ? this.collumn.reverse() : null;\r\n            this.collumn.forEach((element, index, array) => {\r\n                if (this.skip) {\r\n                    this.skip = false;\r\n                    return;\r\n                }\r\n                this.nextElement = array[index + 1];\r\n                this.elementScript = element.getComponent('tilesScript');\r\n                if (this.nextElement === undefined) return;\r\n                this.nextElementScript = this.nextElement.getComponent('tilesScript');\r\n                if (this.elementScript.number === 0) return;\r\n                if (this.elementScript.number === this.nextElementScript.number) {\r\n                    this.skip = true;\r\n                    this.elementScript.setNumber(this.elementScript.number *= 2);\r\n                    element.runAction(cc.sequence(cc.scaleTo(this._time / 2, 1.25), cc.scaleTo(this._time / 2, 1)));\r\n                    this.nextElementScript.moveCombine(element.getPosition(cc.v2()), this._time / 2);\r\n                    this._combined = true;\r\n                }\r\n            });\r\n            directionDown ? this.collumn.reverse() : null;\r\n        }\r\n        return;\r\n    },\r\n\r\n    _adjustPosition: function () {\r\n        this._tilesMatrix.forEach((element, rowIndex) => element.forEach((element, collumnIndex) => {\r\n            if (element.active) {\r\n                let lastPos = element.getPosition(cc.v2());\r\n                this.action = cc.sequence(\r\n                    cc.moveTo(this._time, -157.5 + 105 * collumnIndex, 157.5 - 105 * rowIndex),\r\n                    cc.callFunc(() => {\r\n                        let currentPos = element.getPosition(cc.v2());\r\n                        if (Math.abs(Math.floor(lastPos.x - currentPos.x)) > 25 || Math.abs(Math.floor(lastPos.y - currentPos.y)) > 25) {\r\n                            this._check = true;\r\n                            cc.log('last position', lastPos, 'current position', currentPos, element.name);\r\n                            cc.log('x change', Math.floor(lastPos.x - currentPos.x));\r\n                            cc.log('y change', Math.floor(lastPos.y - currentPos.y));\r\n                        }\r\n                    }),\r\n                );\r\n                element.runAction(this.action);\r\n                return;\r\n            } else {\r\n                element.setPosition(cc.v2(-157.5 + 105 * collumnIndex, 157.5 - 105 * rowIndex));\r\n                return;\r\n            }\r\n        }));\r\n        this.scheduleOnce(() => {\r\n            this._generateRandomValue();\r\n            this.node.dispatchEvent(new cc.Event.EventCustom('updateScore', true));\r\n        }, this._time*2);\r\n        return;\r\n    },\r\n\r\n    _generateRandomValue() {\r\n        cc.log(this._check);\r\n        if (!this._check) return;\r\n        do {\r\n            this.randomCollumn = Math.floor(Math.random() * 4);\r\n            this.randomRow = Math.floor(Math.random() * 4);\r\n            if (this._tilesMatrix.flat().every(element => element.active)) {\r\n                return;\r\n            }\r\n        } while (this._tilesMatrix[this.randomRow][this.randomCollumn].active);\r\n        this.randomTile = this._tilesMatrix[this.randomRow][this.randomCollumn];\r\n        this.number = this.randomTile.getComponent('tilesScript');\r\n        // this.randomTile.once('position-changed', () => this._check = true, this);\r\n        this.randomTile.active = true;\r\n        this.randomTile.scale = 0;\r\n        this.number.setNumber(Math.random() > 0.7 ? 4 : 2);\r\n        this.randomTile.setPosition(cc.v2(-157.5 + 105 * this.randomCollumn, 157.5 - 105 * this.randomRow));\r\n        this.randomTile.runAction(cc.scaleTo(this._time, 1));\r\n        this._check = false;\r\n    },\r\n\r\n    _setupGrid(playing) {\r\n        cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN, this._onKeyDown, this);\r\n        let numberIndex = 1;\r\n        this._tilesMatrix.push([], [], [], []);\r\n        for (let collumn = 0; collumn < 4; collumn++) {\r\n            for (let row = 0; row < 4; row++) {\r\n                this.tile = cc.instantiate(this.tilePrefab);\r\n                this.tile.active = false;\r\n                this.tile.on('mousedown', this._onClick, this.tile);\r\n                this.tile.name = `tile ${numberIndex++}`;\r\n                this.tile.setPosition(cc.v2(-157.5 + 105 * row, 157.5 - 105 * collumn));\r\n                this._tilesMatrix[Number(String((this.tile.getPosition().y - 157.5) * -1)[0])][Number(String(this.tile.getPosition().x + 157.5)[0])] = this.tile;\r\n                this.node.addChild(this.tile);\r\n            }\r\n        }\r\n        if (playing) return;\r\n        for (let i = 0; i < 2; i++) {\r\n            this._check = true;\r\n            this._generateRandomValue();\r\n        }\r\n        cc.log(this._tilesMatrix);\r\n        this._check = false;\r\n    },\r\n\r\n    _checkWin: function () {\r\n        let win = false;\r\n        this._tilesMatrix.flat().forEach(element => element.getComponent('tilesScript').number === 2048 ? win = true : null);\r\n        if (win) {\r\n            cc.log('you have won');\r\n            cc.systemEvent.off(cc.SystemEvent.EventType.KEY_DOWN, this._onKeyDown, this);\r\n            this.scheduleOnce(() => {\r\n                this.node.dispatchEvent(new cc.Event.EventCustom('win', true));\r\n            }, 0.5);\r\n            return true;\r\n        }\r\n        return false;\r\n    },\r\n\r\n    _checkLose: function () {\r\n        if (!this._tilesMatrix.flat().every(element => element.active)) return;\r\n        this.checkRow = this._tilesMatrix.every((element) => {\r\n            if (element.every((element, index, array) => {\r\n                if (array[index + 1] === undefined) return true;\r\n                this.number = element.getComponent('tilesScript').number;\r\n                this.nextNumber = array[index + 1].getComponent('tilesScript').number;\r\n                if (this.number !== this.nextNumber) return true;\r\n                return false;\r\n            })) return true;\r\n            return false;\r\n        });\r\n        this.checkCollumn = this._tilesMatrix.flat().every((element, index, array) => {\r\n            if (array[index + 4] === undefined) return true;\r\n            this.number = element.getComponent('tilesScript').number;\r\n            this.nextNumber = array[index + 4].getComponent('tilesScript').number;\r\n            if (this.number !== this.nextNumber) return true;\r\n            return false;\r\n        });\r\n        if (this.checkCollumn && this.checkRow) {\r\n            cc.log('you have lost');\r\n            cc.systemEvent.off(cc.SystemEvent.EventType.KEY_DOWN, this._onKeyDown, this);\r\n            this.scheduleOnce(() => {\r\n                this.node.dispatchEvent(new cc.Event.EventCustom('lose', true));\r\n            }, 0.5);\r\n            return true;\r\n        }\r\n        return false;\r\n    },\r\n\r\n    _reset() {\r\n        this._tilesMatrix = [];\r\n        this.node.children.splice(1, 16);\r\n        this.node.dispatchEvent(new cc.Event.EventCustom('updateScore', true));\r\n        cc.log(this.node.children);\r\n    },\r\n\r\n    _onClick: function () {\r\n        cc.log(this.name);\r\n        this.script = this.getComponent('tilesScript');\r\n        this.script.setNumber(this.script.number === 2 ? 4 : 2);\r\n        // this.script.setNumber(2048);\r\n        return;\r\n        cc.log(this.getPosition(cc.v2()));\r\n    },\r\n\r\n    onLoad() {\r\n        this.node.on('checkWin', this._checkWin, this);\r\n        this.node.on('checkLose', this._checkLose, this);\r\n        this.node.on('move', (event) => {\r\n            event.stopPropagation();\r\n            this._check = true;\r\n        }, this);\r\n    },\r\n\r\n    start() {\r\n    },\r\n\r\n    update(dt) {\r\n    },\r\n});\r\n"]}