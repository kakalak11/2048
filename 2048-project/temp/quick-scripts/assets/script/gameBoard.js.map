{"version":3,"sources":["gameBoard.js"],"names":["Emitter","require","cc","Class","extends","Component","properties","tilePrefab","Prefab","_tilesMatrix","_moving","_onKeyDown","event","keyCode","macro","KEY","right","_moveRight","left","_moveLeft","down","_moveDown","up","_moveUp","space","_generateRandomValue","forEach","element","rowIndex","numbers","filter","active","zeros","concat","collumnIndex","runAction","sequence","moveTo","callFunc","i","shift","node","emit","collumn","j","push","index","_showPostion","_combineTiles","log","randomArray","randomIndex","Math","floor","random","length","every","randomTile","getComponent","setNumber","number","scale","scaleTo","easing","easeExponentialIn","_setupGrid","numberIndex","row","tile","instantiate","name","setPosition","v2","Number","String","getPosition","y","x","addChild","onLoad","systemEvent","on","SystemEvent","EventType","KEY_DOWN","start","update","dt"],"mappings":"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","file":"gameBoard.js","sourceRoot":"..\\..\\..\\..\\assets\\script","sourcesContent":["// Learn cc.Class:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/class.html\r\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/class.html\r\n// Learn Attribute:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\r\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\r\n//  - [English] https://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\r\n\r\nconst Emitter = require('event');\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        tilePrefab: cc.Prefab,\r\n        _tilesMatrix: [],\r\n        _moving: null,\r\n    },\r\n\r\n    // LIFE-CYCLE CALLBACKS:\r\n\r\n    _onKeyDown: function (event) {\r\n        if (this._moving) return;\r\n        switch (event.keyCode) {\r\n            case cc.macro.KEY.right:\r\n                this._moving = true;\r\n                this._moveRight();\r\n                break;\r\n            case cc.macro.KEY.left:\r\n                this._moving = true;\r\n                this._moveLeft();\r\n                break;\r\n            case cc.macro.KEY.down:\r\n                this._moving = true;\r\n                this._moveDown();\r\n                break;\r\n            case cc.macro.KEY.up:\r\n                this._moving = true;\r\n                this._moveUp();\r\n                break;\r\n            case cc.macro.KEY.space:\r\n                // this._showPostion();\r\n                this._generateRandomValue();\r\n                break;\r\n        }\r\n    },\r\n\r\n    _moveRight: function () {\r\n        this._tilesMatrix.forEach((element, rowIndex) => {\r\n            let numbers = element.filter(element => element.active);\r\n            let zeros = element.filter(element => !element.active);\r\n            element = zeros.concat(numbers);\r\n            element.forEach((element, collumnIndex) => element.runAction(cc.sequence(cc.moveTo(0.25, -157.5 + 105 * collumnIndex, 157.5 - 105 * rowIndex), cc.callFunc(() => {\r\n                this._moving = false;\r\n            }))));\r\n            for (let i = 0; i < 4; i++) {\r\n                this._tilesMatrix[rowIndex][i] = element.shift();\r\n            }\r\n        });\r\n\r\n        this.node.emit('move');\r\n    },\r\n\r\n    _moveLeft: function () {\r\n        this._tilesMatrix.forEach((element, rowIndex) => {\r\n            let numbers = element.filter(element => element.active);\r\n            let zeros = element.filter(element => !element.active);\r\n            element = numbers.concat(zeros);\r\n            element.forEach((element, collumnIndex) => element.runAction(cc.sequence(cc.moveTo(0.25, -157.5 + 105 * collumnIndex, 157.5 - 105 * rowIndex), cc.callFunc(() => {\r\n                this._moving = false;\r\n            }))));        \r\n            for (let i = 0; i < 4; i++) {\r\n                this._tilesMatrix[rowIndex][i] = element.shift();\r\n            }\r\n        });\r\n        this.node.emit('move');\r\n    },\r\n\r\n    _moveDown: function () {\r\n        for (let i = 0; i < 4; i++) {\r\n            let collumn = [];\r\n            for (let j = 0; j < 4; j++) {\r\n                collumn.push(this._tilesMatrix[j][i]);\r\n            }\r\n            let numbers = collumn.filter(element => element.active);\r\n            let zeros = collumn.filter(element => !element.active);\r\n            collumn = zeros.concat(numbers);\r\n            collumn.forEach((element, index) => element.runAction(cc.sequence(cc.moveTo(0.25, -157.5 + 105 * i, 157.5 - 105 * index), cc.callFunc(() => {\r\n                this._moving = false;\r\n            }))));\r\n            for (let j = 0; j < 4; j++) {\r\n                this._tilesMatrix[j][i] = collumn.shift();\r\n            }\r\n        }\r\n        this.node.emit('move');\r\n    },\r\n\r\n    _moveUp: function () {\r\n        for (let i = 0; i < 4; i++) {\r\n            let collumn = [];\r\n            for (let j = 0; j < 4; j++) {\r\n                collumn.push(this._tilesMatrix[j][i]);\r\n            }\r\n            let numbers = collumn.filter(element => element.active);\r\n            let zeros = collumn.filter(element => !element.active);\r\n            collumn = numbers.concat(zeros);\r\n            collumn.forEach((element, index) => element.runAction(cc.sequence(cc.moveTo(0.25, -157.5 + 105 * i, 157.5 - 105 * index), cc.callFunc(() => {\r\n                this._moving = false;\r\n            }))));\r\n            for (let j = 0; j < 4; j++) {\r\n                this._tilesMatrix[j][i] = collumn.shift();\r\n            }\r\n        }\r\n        this.node.emit('move');\r\n    },\r\n\r\n    _showPostion() {\r\n\r\n    },\r\n\r\n    _combineTiles: function () {\r\n        this._tilesMatrix.forEach(element => {\r\n\r\n        });\r\n    },\r\n\r\n    _generateRandomValue() {\r\n        cc.log(this._tilesMatrix);\r\n        let randomArray = [];\r\n        this._tilesMatrix.forEach(element => {\r\n            randomArray.push(element.filter(element => !element.active));\r\n        });\r\n        let randomIndex = Math.floor(Math.random() * randomArray.length);\r\n        while (!randomArray[randomIndex].length) {\r\n            randomIndex = Math.floor(Math.random() * randomArray.length);\r\n            cc.log('generate new random');\r\n            if (randomArray.every(element => !element.length)) {\r\n                this.node.emit('gameOver');\r\n                cc.log('game over');\r\n                return;\r\n            }\r\n        };\r\n        let randomTile = randomArray[randomIndex][Math.floor(Math.random() * randomArray[randomIndex].length)];\r\n        randomTile.active = true;\r\n        randomTile.getComponent('tilesScript').setNumber(randomTile.getComponent('tilesScript').number);\r\n        randomTile.scale = 0\r\n        randomTile.runAction(cc.scaleTo(0.25, 1).easing(cc.easeExponentialIn(0.25)));\r\n        return;\r\n    },\r\n\r\n    _setupGrid() {\r\n        let numberIndex = 1;\r\n        this._tilesMatrix.push([], [], [], []);\r\n        for (let collumn = 0; collumn < 4; collumn++) {\r\n            for (let row = 0; row < 4; row++) {\r\n                let tile = cc.instantiate(this.tilePrefab);\r\n                tile.active = Math.random() > 0.9 ? true : false;\r\n                tile.getComponent('tilesScript').setNumber(numberIndex);\r\n                tile.name = `tile ${numberIndex++}`;\r\n                tile.setPosition(cc.v2(-157.5 + 105 * row, 157.5 - 105 * collumn));\r\n                // cc.log(Number(String(tile.getPosition().x + 157.5)[0]), Number(String((tile.getPosition().y - 157.5) * -1)[0]));\r\n                this._tilesMatrix[Number(String((tile.getPosition().y - 157.5) * -1)[0])][Number(String(tile.getPosition().x + 157.5)[0])] = tile;\r\n                this.node.addChild(tile);\r\n            }\r\n        }\r\n    },\r\n\r\n    onLoad() {\r\n        cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN, this._onKeyDown, this);\r\n        this.node.on('move', this._generateRandomValue, this);\r\n    },\r\n\r\n    start() {\r\n        this._setupGrid();\r\n    },\r\n\r\n    update(dt) {\r\n\r\n    },\r\n});\r\n"]}